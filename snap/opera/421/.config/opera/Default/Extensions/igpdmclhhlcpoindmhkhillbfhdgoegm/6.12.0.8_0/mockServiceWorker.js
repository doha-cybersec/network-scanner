const PACKAGE_VERSION="2.10.4",INTEGRITY_CHECKSUM="f5825c521429caf22a4dd13b66e243af",IS_MOCKED_RESPONSE=Symbol("isMockedResponse"),activeClientIds=new Set;async function handleRequest(e,t){const n=await resolveMainClient(e),i=e.request.clone(),s=await getResponse(e,n,t);if(n&&activeClientIds.has(n.id)){const e=await serializeRequest(i),a=s.clone();sendToClient(n,{type:"RESPONSE",payload:{isMockedResponse:IS_MOCKED_RESPONSE in s,request:{id:t,...e},response:{type:a.type,status:a.status,statusText:a.statusText,headers:Object.fromEntries(a.headers.entries()),body:a.body}}},a.body?[e.body,a.body]:[])}return s}async function resolveMainClient(e){const t=await self.clients.get(e.clientId);if(activeClientIds.has(e.clientId))return t;if("top-level"===t?.frameType)return t;return(await self.clients.matchAll({type:"window"})).filter((e=>"visible"===e.visibilityState)).find((e=>activeClientIds.has(e.id)))}async function getResponse(e,t,n){const i=e.request.clone();function s(){const e=new Headers(i.headers),t=e.get("accept");if(t){const n=t.split(",").map((e=>e.trim())).filter((e=>"msw/passthrough"!==e));n.length>0?e.set("accept",n.join(", ")):e.delete("accept")}return fetch(i,{headers:e})}if(!t)return s();if(!activeClientIds.has(t.id))return s();const a=await serializeRequest(e.request),r=await sendToClient(t,{type:"REQUEST",payload:{id:n,...a}},[a.body]);switch(r.type){case"MOCK_RESPONSE":return respondWithMock(r.data);case"PASSTHROUGH":return s()}return s()}function sendToClient(e,t,n=[]){return new Promise(((i,s)=>{const a=new MessageChannel;a.port1.onmessage=e=>{if(e.data&&e.data.error)return s(e.data.error);i(e.data)},e.postMessage(t,[a.port2,...n.filter(Boolean)])}))}function respondWithMock(e){if(0===e.status)return Response.error();const t=new Response(e.body,e);return Reflect.defineProperty(t,IS_MOCKED_RESPONSE,{value:!0,enumerable:!0}),t}async function serializeRequest(e){return{url:e.url,mode:e.mode,method:e.method,headers:Object.fromEntries(e.headers.entries()),cache:e.cache,credentials:e.credentials,destination:e.destination,integrity:e.integrity,redirect:e.redirect,referrer:e.referrer,referrerPolicy:e.referrerPolicy,body:await e.arrayBuffer(),keepalive:e.keepalive}}addEventListener("install",(function(){self.skipWaiting()})),addEventListener("activate",(function(e){e.waitUntil(self.clients.claim())})),addEventListener("message",(async function(e){const t=Reflect.get(e.source||{},"id");if(!t||!self.clients)return;const n=await self.clients.get(t);if(!n)return;const i=await self.clients.matchAll({type:"window"});switch(e.data){case"KEEPALIVE_REQUEST":sendToClient(n,{type:"KEEPALIVE_RESPONSE"});break;case"INTEGRITY_CHECK_REQUEST":sendToClient(n,{type:"INTEGRITY_CHECK_RESPONSE",payload:{packageVersion:"2.10.4",checksum:INTEGRITY_CHECKSUM}});break;case"MOCK_ACTIVATE":activeClientIds.add(t),sendToClient(n,{type:"MOCKING_ENABLED",payload:{client:{id:n.id,frameType:n.frameType}}});break;case"MOCK_DEACTIVATE":activeClientIds.delete(t);break;case"CLIENT_CLOSED":{activeClientIds.delete(t);const e=i.filter((e=>e.id!==t));0===e.length&&self.registration.unregister();break}}})),addEventListener("fetch",(function(e){if("navigate"===e.request.mode)return;if("only-if-cached"===e.request.cache&&"same-origin"!==e.request.mode)return;if(0===activeClientIds.size)return;const t=crypto.randomUUID();e.respondWith(handleRequest(e,t))}));