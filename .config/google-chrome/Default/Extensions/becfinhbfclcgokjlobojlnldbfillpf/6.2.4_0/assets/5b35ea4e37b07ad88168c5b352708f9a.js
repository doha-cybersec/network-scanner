import{p as v,a as w,b as F}from"./91125fddb13c171d06c5858ecf5bea69.js";import{A as U,_ as x}from"./8d303f94e93901152d11040290f309bc.js";import{H as P,A as E}from"./7afd07c687eb49d39fd77bf78fe5ec25.js";import{F as b}from"./0196d58bb8642dce6457d13d94d33c17.js";import{d as k,a_ as g,H as C,aP as c,bH as I,L as r,J as h,I as _,bc as f,X as y,aA as A,bM as m}from"./87a84c2cf7b4fda35bfcac0640ac264b.js";import"./93c5775672b5704373697ce70541c884.js";import"./ccb02b363d45d8a770185e0773c7b631.js";import"./bcf4134a4a556de4ee403352524ff81a.js";import"./2736eeee414806ef50a46b2dbb19ce49.js";import"./7efee2cfaa139c0e5c25b42987b40778.js";import"./0811d7a4c39e6078b59d515398ad441d.js";import"./dcea5b6683ffc6e329bf502a60c8c88d.js";import"./b266269d4bacae7ca70e8b4e8fa98e86.js";import"./c90f206377370d0637b0d1ca16e84cd3.js";import"./85e6709c31dd87565e34195aad62877a.js";import"./24f2f391bb30a906fed56b8bff743fcb.js";import"./ff1c62831b919e645c41cf9dce23d935.js";import"./9c387392fdc5bbcf7335d803b777bc34.js";import"./730ecdbe744cb4a1446d00cb2b3bdbb1.js";import"./35a4e9e5b03ce9f6b934005df8651842.js";import"./4d8530bbbd6abd9246d7a47fdf83b94b.js";import"./c63a988018a19bb069147e542d0100cc.js";import"./a1f937a8f2e3868bc093764a98119575.js";import"./2aa242c5d59db38b285a255688e851e9.js";import"./1b8ead64d23fbbfcf48d4652332960c3.js";import"./75b49a1b196983c05948f45215119584.js";import"./4cfe72e6823fa90866abd661c90d1a61.js";import"./4a65be22bddb73e1999558835fb6bba1.js";import"./0ad26b610ddcef096d4d865b8c763f01.js";import"./d773a614e054f2d9aec56b1b79e4c625.js";import"./247181262fddb482b5c9ae0bba2666ad.js";import"./ffddd36e5ff55eed5b60f74a6e818f25.js";import"./e1b38652fd58232a8f02469e29295aab.js";import"./d1b65f4321c0417f893639d35dc980fe.js";import"./6f91a82c1b3d972807b78791ed186c86.js";import"./34eaacfb0e840cf04d070f0b6c14639f.js";import"./3b2640d687b5327271e57663b50c251b.js";import"./54e18790c5fc36d3ab2a9cee8314e668.js";import"./aabeb46aa265f5891225553a7beae8bb.js";import"./c1f6401f16daacfb12ff6f86c9d0a5d3.js";F.GlobalWorkerOptions.workerSrc=w;const M=async e=>await new Promise(((a,t)=>{const r=new FileReader;r.onload=async e=>{var r;if(null!=(r=e.target)&&r.result)try{const t=await v.getDocument({data:e.target.result}).promise;let r="";for(let e=1;e<=t.numPages;e++)try{const a=undefined;r+=(await(await t.getPage(e)).getTextContent()).items.map((e=>e.str)).join(" ")}catch(o){console.log(`Error occurred while reading page ${e}: ${o}`);continue}t.destroy(),a(r)}catch(i){t(`Error occurred while reading PDF file: ${i}`)}else t("No result found")},r.onerror=()=>{t(`Error occurred while reading file: ${r.error}`)},r.readAsArrayBuffer(e)})),S=k({extends:U,name:"PdfUploader",computed:{acceptedFileTypes:()=>".pdf,.doc,.docx,.xlsx,.xls,.ppt,.pptx"},data:()=>({pdfUploadErrorMessage:"",pdfUploadPromptId:"",pdfUploadIsProcessing:!1,pdfUploadDragActive:!1}),methods:{async uploadPDF(e){const a=e.target.files[0];await this.processFile(a)},dragOver(e){e.preventDefault(),this.pdfUploadDragActive=!0},dragEnter(e){e.preventDefault(),this.pdfUploadDragActive=!0},dragLeave(e){e.preventDefault(),this.pdfUploadDragActive=!1},async handleDrop(e){const a=e.dataTransfer.files[0];await this.processFile(a)},async processFile(e){if(["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation"].includes(e.type)){this.pdfUploadErrorMessage="",this.pdfUploadIsProcessing=!0;try{let r="";if("application/pdf"!==e.type){const o=b.getInstance();try{await o.loadPDF(e);const t=o.getPdfDoc();if(!t)throw new Error("Failed to convert file to PDF format");for(let e=1;e<=t.numPages;e++)try{const a=undefined;r+=(await(await t.getPage(e)).getTextContent()).items.map((e=>e.str)).join(" ")}catch(a){console.log(`Error occurred while reading page ${e}: ${a}`);continue}await o.cleanup()}catch(t){return console.error("Error converting file:",t),this.pdfUploadErrorMessage=this.__("Error processing this file format. Please try again or use a PDF file."),void(this.pdfUploadIsProcessing=!1)}}else r=await M(e);if(""===r)return this.pdfUploadErrorMessage=this.__("Content of the file is empty. Please upload a regular PDF file. Photo converted PDF files cannot be used at ChatPDF"),void(this.pdfUploadIsProcessing=!1);this.changeStorage("settings.web_access",!1,!1),this.pdfUploadPromptId=P.SHA1(this.getFileName(e));const o="",i=e.name;this.newChat(),this.closeModel(),this.changeStorage("settings.ai_model",this.constants.ai_default_model),this.aiChat(r,this.constants.ai_default_model,"ai_chat","__all",!0,!1,i,!1,{is_pdf:!0,prompt_prefix:E.prompt_prefix,language_name:this.settings.language_name}),null!=document.querySelector("#fileInputPDF")&&(document.querySelector("#fileInputPDF").value=null)}catch(r){console.log(r),this.pdfUploadErrorMessage=this.__("Something went wrong. Please try again.")}finally{this.pdfUploadIsProcessing=!1}}else this.pdfUploadErrorMessage=this.__("Please upload a PDF, Word, Excel, or PowerPoint file")},getFileName:e=>P.slugify(e.name),closeModel(){let e=document.querySelector('[data-ait-dropdown-toggle="ait-pdf-upload-modal"]');e&&(this.pdfUploadPromptId="",e.click()),e=document.querySelector("#ait-pdf-upload-modal button[data-modal-hide]"),e&&(this.pdfUploadPromptId="",e.click())}}}),$={class:"ait-p-4 ait-w-full ait-text-center ait-flex ait-flex-col ait-items-center ait-gap-3"},N={class:"ait-px-4 ait-text-sm ait-text-neutral-600 dark:ait-text-neutral-400"},T=["disabled","accept"],B={for:"fileInputPDF",class:"ait-w-full ait-h-full ait-relative ait-z-[9999]"},H={class:"ait-flex ait-flex-col ait-w-full ait-p-6 ait-items-center ait-justify-center ait-mt-4 ait-border-2 ait-border-dotted ait-border-neutral-300 dark:ait-border-neutral-700 ait-rounded-lg ait-text-neutral-600 dark:ait-text-neutral-400 ait-text-center ait-cursor-pointer ait-transition-all hover:ait-opacity-70"},q={class:"ait-flex ait-flex-col ait-items-center ait-gap-1 ait-mt-2"},W={class:"ait-block ait-text-xs"},L={key:0,class:"ait-flex ait-justify-center ait-items-center ait-h-25"},O={class:"ait-h-6"},V={key:0,class:"ait-text-red-500 ai-text-sm"},j={key:0,class:"ait-p-4"};function z(e,a,t,o,i,s){const d=g("svg-logo"),l=g("single-response"),p=g("modal");return c(),C(p,{title:e.__("Upload File"),id:"ait-pdf-upload-modal",className:"ait-items-center",onDrop:m(e.handleDrop,["prevent"]),onDragover:m(e.dragOver,["prevent"]),onDragenter:m(e.dragEnter,["prevent"]),onDragleave:m(e.dragLeave,["prevent"])},{default:I((()=>[r("div",$,[r("p",N,f(e.__("Upload a PDF, Word, Excel, or PowerPoint file to easily get intelligent summaries and answers for your documents.")),1),r("input",{type:"file",id:"fileInputPDF",onChange:a[0]||(a[0]=(...a)=>e.uploadPDF&&e.uploadPDF(...a)),disabled:e.pdfUploadIsProcessing,accept:e.acceptedFileTypes,style:{display:"none"}},null,40,T),r("label",B,[r("div",H,[y(d,{className:"ait-w-16 ait-h-16 ait-opacity-60",name:"file_icon"}),r("div",q,[r("span",W,f(e.__("Supported file types are PDF, Word, Excel, and PowerPoint")),1)]),r("span",{class:A(["ait-block ait-mt-2",e.pdfUploadDragActive?"ait-opacity-100":"ait-opacity-60"])},f(e.pdfUploadDragActive?e.__("Drop your file here"):e.__("Drag your file here or click to upload")),3)])]),e.pdfUploadIsProcessing?(c(),h("div",L,a[1]||(a[1]=[r("div",{class:"ait-border-4 ait-border-solid ait-border-t-transparent ait-border-gray-200 ait-rounded-full ait-w-9 ait-h-9 ait-animate-spin"},null,-1)]))):_("",!0),r("div",O,[e.pdfUploadErrorMessage?(c(),h("p",V,f(e.pdfUploadErrorMessage),1)):_("",!0)])]),this.pdfUploadPromptId?(c(),h("div",j,[y(l,{class:"ait-p-2 ait-rounded-lg ait-bg-neutral-100 dark:ait-bg-neutral-900 dark:ait-text-gray-200",id:"aitopia-pdf-summary",custom_key:this.pdfUploadPromptId,onContinueChatClick:this.closeModel},null,8,["custom_key","onContinueChatClick"])])):_("",!0)])),_:1},8,["title","onDrop","onDragover","onDragenter","onDragleave"])}const Me=x(S,[["render",z]]);export{Me as default};