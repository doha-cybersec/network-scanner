import{B as ne}from"./9c387392fdc5bbcf7335d803b777bc34.js";import{d as ae,o as le}from"./730ecdbe744cb4a1446d00cb2b3bdbb1.js";import{C as D}from"./ccb02b363d45d8a770185e0773c7b631.js";import{d as se}from"./2736eeee414806ef50a46b2dbb19ce49.js";import{M as oe}from"./0811d7a4c39e6078b59d515398ad441d.js";import{m as re}from"./dcea5b6683ffc6e329bf502a60c8c88d.js";import{H as Y}from"./b266269d4bacae7ca70e8b4e8fa98e86.js";import{m as fe}from"./35a4e9e5b03ce9f6b934005df8651842.js";import"./24f2f391bb30a906fed56b8bff743fcb.js";import{l as ue}from"./4d8530bbbd6abd9246d7a47fdf83b94b.js";const f={Local:{},Sync:{},LocalOld:{},SyncOld:{},LocalQuote:0,LocalUsageQuote:0,LocalKeyByUsage:{},constructor(){},build:async(e="local",t=0)=>await new Promise((async(a,n)=>await l.Browser().storage[e].get(null).then((async n=>{let i=l.firstUpperCase(e),o=f[i];return Object.keys(n).forEach((e=>{typeof o[e]<"u"&&delete o[e]})),Object.keys(o).length>0&&(await l.Browser().storage[e].set(o),n=Object.assign(o,n)),f[i]=l.JsonParse(n),0==f.LocalUsageQuote&&await f.quoteCheck(),a(1==t?f[e]:f)})).catch((async e=>{if(console.log(e),-1!==e.indexOf("QUOTA_BYTES"))return await f.cleanUpStorage(!0);console.log(e)})))),async listener(e){return typeof l.Browser().storage.migration_status>"u"&&(l.Browser().storage.migration_status=!1),l.Browser().storage.onChanged.addListener(((t,a)=>{let n=Object.keys(t);if(-1!==n.indexOf("migration_status")){let e=n[n.indexOf("migration_status")];l.Browser().storage.migration_status=t[e].newValue??!1}return Object.keys(t).forEach((e=>{let n=e,l=t[e].oldValue,i=t[e].newValue;if(typeof f[a]>"u"&&(f[a]={}),typeof f[`${a}Old`]>"u"&&(f[`${a}Old`]={}),typeof i<"u"&&null!=i?typeof i[n]<"u"?this[a][n]=f[a][n]=i[n]:this[a][n]=f[a][n]=i:this[a][n]=f[a][n]=null,typeof l<"u"&&null!=l?typeof l[n]<"u"?this[`${a}Old`][n]=f[`${a}Old`][n]=l[n]:this[`${a}Old`][n]=f[`${a}Old`][n]=l:this[`${a}Old`][n]=f[`${a}Old`][n]=null,-1!==n.indexOf("ai_single_")){let e=n.replace("ai_single_","");null==this[a].ai_single&&(this[a].ai_single=f[a].ai_single={}),this[a].ai_single&&typeof this[a].ai_single[e]>"u"&&(this[a].ai_single[e]=f[a].ai_single[e]={}),typeof i[n]<"u"?this[a].ai_single[e]=f[a].ai_single[e]=i[n]:this[a].ai_single[e]=f[a].ai_single[e]=i,console.log(f[a].ai_single[e],i[n],i)}})),e.storage=f,Object.keys(t).forEach((t=>{"settings"==t&&null==f[a][t]&&console.error(t,f[a][t]),f[a][t]!=f[`${a}Old`][t]&&e.changeListener(a,t,f[a][t],f[`${a}Old`][t],l.Browser().storage.migration_status??!1)})),f}))},async quoteCheck(){if(typeof l.Browser().storage.local.QUOTA_BYTES<"u"){f.LocalQuote=l.Browser().storage.local.QUOTA_BYTES;let e=0,t=await l.Browser().storage.local.get();t&&(Object.keys(t).forEach((a=>{let n={};n[a]=t[a];let l=new Blob([JSON.stringify(n)]).size;e+=l,this.LocalKeyByUsage[a]=l})),f.LocalUsageQuote=e,await f.cleanUpStorage())}},async cleanUpStorage(e=!1){let t=f.LocalQuote,a=f.LocalUsageQuote,n,i=!1,o=null,s=5e4,r=19;if(t-=2e5,t<=a||1==e){console.log(t,a,e,t<=a||1==e);let n=await l.Browser().storage.local.get("ai_chat");if(typeof n.ai_chat<"u"){let e=n.ai_chat;if(null!==e){let t=Object.keys(e);t.length>11?t.forEach((e=>{Number.parseInt(e)>0&&Object.keys(n.ai_chat).length>r&&(delete n.ai_chat[e],n.ai_chat=Object.values(n.ai_chat),i=!0,o="ai_chat")})):t.forEach((t=>{e[t]&&typeof e[t].item<"u"&&(e[t].item.length>s?(n.ai_chat[t].item=e[t].item=e[t].item.toString().substring(0,s),i=!0,o="ai_chat"):typeof e[t].prompt<"u"&&e[t].prompt.length>s&&(n.ai_chat[t].prompt=e[t].prompt=e[t].prompt.toString().substring(0,s),i=!0,o="ai_chat"))}))}}if(i&&null!=o)return await l.Browser().storage.local.set(n).catch((async e=>{-1!==e.indexOf("QUOTA_BYTES")&&(await l.Browser().storage.local.remove(o),await l.Browser().storage.local.set(n))})),f.quoteCheck()}}},O={db_name:"AiTopia",open_db:null,db_version:1,open:async(e=null)=>{if(null!=e&&(O.db_name=e),location&&location.search&&-1!==location.search.indexOf("clear")&&null==O.open_db){await indexedDB.deleteDatabase(O.db_name);let e=new URLSearchParams(location.search);e.delete("clear"),Object.keys(e).length>0?window.location.href=window.location.origin+"?"+e.toString()+location.hash:window.location.href=window.location.origin}return O.open_db=await le(O.db_name,O.db_version,{upgrade(e,t,a,n,l){e.createObjectStore(O.db_name,{keyPath:"key",autoIncrement:!1})},blocked(e,t,a){console.log("BLOCKED")},blocking(e,t,a){console.log("BLOCKING")},terminated(){console.log("TERMINATE")}})},storage:{get:async(e=null)=>{let t={};return"string"==typeof e&&null!=e&&(e=[e]),(null==e||"object"!=typeof e)&&(e=[]),new Promise((async(a,n)=>{let i=await O.open();try{let e=await i.transaction(O.db_name,"readonly").objectStore(O.db_name)}catch(c){return void console.log(c)}let o=await i.transaction(O.db_name,"readonly").objectStore(O.db_name),s=!1,r=[];if(e&&e.length>0){for(let t of e){let e=null;l.notUndefined(f.Local,t)?e={key:t,value:l.notUndefined(f.Local,t)}:(t=l.AesEnCrypt(t),e=await o.get(t),l.notUndefined(e,"key")&&(e.key=l.AesDeCrypt(e.key)??e.key),l.notUndefined(e,"value")&&(e.value=l.JsonParse(l.AesDeCrypt(e.value)??e.value))),r.push(e)}s=!0}s||(r=await o.getAll()),r&&r.forEach((e=>{if(l.notUndefined(e,"value")){let a=l.notUndefined(e,"key"),n=l.notUndefined(e,"value");s||(a=l.AesDeCrypt(a)??null,n=l.JsonParse(l.AesDeCrypt(n)??null)??null),t[a]=f.Local[a]=n}})),a(t)}))},set:async(e={})=>await new Promise((async(t,a)=>{let n=await(await O.open()).transaction(O.db_name,"readwrite").objectStore(O.db_name),i={};if(e&&Object.keys(e).length>0){let t=!1;for(const a of Object.keys(e)){let o=!1;e[a]=l.JsonParse(e[a]);let s={key:l.AesEnCrypt(a),value:l.AesEnCrypt(JSON.stringify(e[a]))??null,updated_date:(new Date).getTime()},r=await n.getKey(l.AesEnCrypt(a)),c=await n.get(l.AesEnCrypt(a));l.notUndefined(c,"key")&&(c.key=l.AesDeCrypt(c.key)??c.key),l.notUndefined(c,"value")&&(c.value=l.JsonParse(l.AesDeCrypt(c.value)??c.value)),typeof r>"u"?(await n.add(s),t=o=!0,i[a]={oldValue:null,newValue:e[a]}):l.notUndefined(c,"value")!=JSON.stringify(e[a])&&(i[a]={oldValue:null,newValue:e[a]},i[a].oldValue=l.JsonParse(l.notUndefined(c,"value")??null)??null,await n.put(s),t=o=!0),o&&(f.Local[a]=e[a])}t&&window.dispatchEvent(new CustomEvent("localStorageOnChange",{detail:i}))}t(!0)})),remove:async e=>new Promise((async(t,a)=>{if(e){let t=await(await O.open()).transaction(O.db_name,"readwrite").objectStore(O.db_name);if(e.length>0&&"object"==typeof e)for(const a of e)if(typeof f.Local[a]<"u"||typeof f.Local[a]<"u"){let e={};e[a]={oldValue:f.Local[a]??f.Local[a]??null,newValue:null},await t.delete(l.AesEnCrypt(a)),typeof f.Local[a]<"u"&&delete f.Local[a],typeof f.Local[a]<"u"&&delete f.Local[a],window.dispatchEvent(new CustomEvent("localStorageOnChange",{detail:e}))}}t(!0)})),clear:async()=>new Promise((async(e,t)=>{await ae(O.db_name),window.location.reload(),e(!0)}))},customAddListener:(e,t,a)=>window.addEventListener(e,(e=>"function"==typeof t?t(e.detail,a):{detail:e.detail,namespace:a}))};typeof window<"u"&&(window.umut_storage=O.storage);const ce={storage:{local:O.storage,onChanged:{addListener:(e,t)=>O.customAddListener("localStorageOnChange",e,"Local")}},runtime:{id:null}};let I=ne;typeof chrome<"u"&&(I=chrome??I);let ie="aitopia.ai";const z=[ie,"chatgptextension.ai"];let R=location.hostname.split(".");var te;R.length>2&&(delete R[0],R=Object.values(R)),R=R.join(".");const F=(null==(te=null==I?void 0:I.runtime)?void 0:te.id)??null;var S=F?`chrome-extension://${F}`:"";S+="/";var C=z[z.indexOf(R)]??z[0];const K="chat.";let de=!1,$=C;C&&(C.split(".").length>2&&(delete(C=C.split("."))[0],C=Object.values(C).join(".").toString()),$=C,-1===C.indexOf("chatgptextension")&&-1===C.indexOf("extension://")&&($=K+$));let ge=["production_beta","development_beta_api"];const X=-1!==ge.indexOf("production")?"beta_api":"extensions",M="src/html",d={domain:C,domain_allows:z,runtime_id:F??null,build_type:"self",main_dir:M,site:`https://${$}`,site_buy_plan:`https://${$}/subscription`,site_payment:`https://${$}/payment`,site_pricing:`https://${$}/pricing`,terms_conditions:`https://${$}/terms-conditions`,privacy_policy:`https://${$}/privacy-policy`,login:`https://${$}/auth`,login_prefix:`https://${$}/auth?logout`,profile:`https://${$}/app/profile`,api_mode:X,api_url:`https://${X}.${C}`,download_url:`https://download.${C}`,cdn_url:`https://cdn.${C}`,web_app_prefix:K,web_app:`https://${K}${ie}`,extension_pricing:`${S}${M}/pricing.html`,extension_payment_success:`${S}${M}/payment_success.html`,extension_google_page:"https://chromewebstore.google.com/detail/chatgpt-sidebar-gpt-4-vis/becfinhbfclcgokjlobojlnldbfillpf",extension_id:F,manuel_extension_id:"becfinhbfclcgokjlobojlnldbfillpf",extension_dir:`${S}`,extension_main_dir:`${S}${M}`,lang_cache_type:"Local",debugMode:0,version:"6.2.4",app_name:"AITOPIA",app_title:"Chat with all AI models (Gemini, Claude, DeepSeek…) & AI Agents | AITOPIA",app_description:"AI Agent Marketplace & AI Sidebar with all AI models (Gemini, Claude, DeepSeek & more) and hundreds of AI Agents",app_search_title:"AITOPIA Sidebar",app_logo:"aitopia.svg",app_logo_full:null,app_install:!0,app_uninstall:!0,app_campaign_page:!1,app_context:!0,app_main_color:null,app_main_color_dark:null,app_main_link_color:null,app_main_link_color_dark:null,app_store_url:null,build_finish:!1,mode:"production",debug_time:"",web_access_search_limit:5,ai_default_model:"AITOPIA",image_upscaling_id:"image-upscaling",console_data:[],hello_world_test:"function helloWorld(args){if (!args)return false;}function testing(args){if (args)return true;}",disallow_pages:["accounts.google.com"],is_web_app:de,search_pages:{"www.google.com/search":{selector:'body textarea[type="search"],body textarea[aria-label="search"],body textarea[name="q"]',container:"#rhs",empty_selector:"#rcnt",empty_selector_position:"#center_col",empty_element:'<div class="TQc1id rhstc4" jscontroller="cSX9Xe" data-pws="1300" data-spe="true" jsaction="rcuQ6b:npT2md" id="rhs" jsdata="MdeVKb;_;A38Ny0" role="complementary" data-hveid="CAEQAA"></div>'},"www.yandex.com/search":{selector:'body [role="search"] [name="text"]',container:"#search-result-aside",empty_selector:".main__content > div",empty_selector_position:"",empty_element:'<div class="content__right content__right_cols_12" id="search-result-aside" data-log-node="2_apy0w00g" tabindex="-1"><div class="serp-list serp-list_right_yes"></div></div>'},"www.bing.com/search":{selector:'body [role="search"] [type="search"],body [role="search"] .b_searchbox',container:"#b_context",empty_selector:"#b_content > aside:first-child",empty_selector_position:"",empty_element:'<ol id="b_context"></ol>'},"www.duckduckgo.com":{selector:'body #search_form_input, body #search_form > input[type="text"]',container:'#web_content_wrapper [data-testid="sidebar"]',empty_selector:"",empty_selector_position:"",empty_element:'<section data-testid="sidebar" data-area="sidebar"></section>'},"search.yahoo.com/search":{selector:'body [role="search"] input[type="text"]',container:"#results > #cols > #right",empty_selector:"",empty_selector_position:"",empty_element:""},"www.baidu.com/s":{selector:'#form [name="wd"],#form #kw',container:"#container #content_right",empty_selector:"",empty_selector_position:"",empty_element:""},"www.ask.com/web":{selector:'[name="searchBoxContainer"] [name="q"]',container:"main .l-right-container",empty_selector:"",empty_selector_position:"",empty_element:""},"search.aol.com":{selector:'[role="search"] [name="q"]',container:"#results > #cols > #right",empty_selector:"",empty_selector_position:"",empty_element:""}},ai_reply:{"mail.google.com":{reply_button:".ams.bkH",button:".amn",container:'[role="listitem"]:last-child',alternative_container:'[role="listitem"]:last-child',edit_container:'[role="listitem"] .editable',reply_insert_container:".Am.Al.editable.LW-avf",dot_position:{bottom:"25%",left:"85%"},detail_elements:[{name:"history",selector:".adL.gmail_quote,.adL .gmail_quote",mode:"simple",type:"textContent"},{name:"sender_email",selector:".gD[email]",mode:"attribute",type:"email"},{name:"sender_name",selector:".gD[name]",mode:"attribute",type:"name"},{name:"receiver_email",selector:".g2[email]",mode:"attribute",type:"email"},{name:"receiver_name",selector:".g2[name]",mode:"attribute",type:"name"},{name:"email_content",selector:".a3s > *",mode:"simple",type:"innerText"}]},"outlook.live.com":{reply_button:".th6py button:first-child",button:".Jj1JU,.th6py",container:'[role="document"][aria-expanded="true"]',alternative_container:'[role="document"][aria-expanded]',edit_container:'[id*="editorParent_"] [role="textbox"][contenteditable="true"]',reply_insert_container:"[id*='editorParent_'] [contenteditable=\"true\"] > *:first-child",dot_position:{bottom:"50%",left:"80%"},detail_elements:[{name:"history",selector:".adL.gmail_quote,.adL .gmail_quote",mode:"simple",type:"textContent"},{name:"sender_email",selector:".OZZZK",mode:"simple",type:"textContent"},{name:"sender_name",selector:".OZZZK",mode:"simple",type:"textContent"},{name:"receiver_email",selector:"._EType_RECIPIENT_ENTITY [aria-label]",mode:"attribute",type:"aria-label"},{name:"receiver_name",selector:"._EType_RECIPIENT_ENTITY [aria-label]",mode:"attribute",type:"aria-label"},{name:"email_content",selector:'[role="document"][aria-expanded="true"] [id*="UniqueMessageBody_"] div',mode:"simple",type:"innerText"}]},"mail.yandex.com":{reply_button:".qa-QuickReplyPlaceholder",button:".ns-view-toolbar-buttons .ns-view-container-desc",container:".mail-Layout-Content",alternative_container:".qa-MessageViewer article:last-child",edit_container:'[role="presentation"] [role="textbox"]',reply_insert_container:'[role="presentation"] [role="textbox"] div',dot_position:{bottom:"25%",left:"75%"},detail_elements:[{name:"history",selector:".qa-MessageViewer article",mode:"simple",type:"textContent"},{name:"sender_email",selector:".qa-MessageViewer-SenderEmail",mode:"attribute",type:"title"},{name:"sender_name",selector:".qa-MessageViewer-SenderName",mode:"attribute",type:"title"},{name:"receiver_email",selector:".qa-MessageViewer-RecipientsTitle",mode:"simple",type:"textContent"},{name:"receiver_name",selector:".qa-MessageViewer-RecipientsTitle",mode:"simple",type:"textContent"},{name:"email_content",selector:".qa-MessageViewer article",mode:"simple",type:"innerText"}]}},ai_reply_data:{},click_open_url:{"aitopia-pricing":"extension_pricing","aitopia-full-screen-page":`${S}${M}/full_screen.html`,"aitopia-login":"login","aitopia-login-prefix":"login_prefix","aitopia-subscription":"site_buy_plan","aitopia-profile":"profile","aitopia-g-extension":"extension_google_page","aitopia-options":`${S}${M}/options.html`,"aitopia-options-search":`${S}${M}/options.html?mode=search`,"aitopia-contact":`${S}${M}/options.html?mode=contact`,"aitopia-options-yt":`${S}${M}/options.html?mode=youtube`,"aitopia-terms":"terms_conditions","aitopia-privacy":"privacy_policy"},aspect_rations:[{value:"21 : 9",tooltipText:"1536 x 640",width:"1536",height:"640"},{value:"16 : 9",tooltipText:"1344 x 768",width:"1344",height:"768"},{value:"3 : 2",tooltipText:"1216 x 832",width:"1216",height:"832"},{value:"5 : 4",tooltipText:"1152 x 896",width:"1152",height:"896"},{value:"1 : 1",tooltipText:"1024 x 1024",width:"1024",height:"1024"},{value:"4 : 5",tooltipText:"896 x 1152",width:"896",height:"1152"},{value:"2 : 3",tooltipText:"832 x 1216",width:"832",height:"1216"},{value:"9 : 16",tooltipText:"768 x 1344",width:"768",height:"1344"},{value:"9 : 21",tooltipText:"640 x 1536",width:"640",height:"1536"}],styles:[{name:"None",style:"none",icon:`${S}/assets/images/image_chat/default.png`},{name:"Anime",style:"anime",icon:`${S}/assets/images/image_chat/anime.png`},{name:"Photographic",style:"photographic",icon:`${S}/assets/images/image_chat/photographic.png`},{name:"Digital Art",style:"digital-art",icon:`${S}/assets/images/image_chat/digital_art.png`},{name:"Comic Book",style:"comic-book",icon:`${S}/assets/images/image_chat/comic_book.png`},{name:"Fantasy Art",style:"fantasy-art",icon:`${S}/assets/images/image_chat/fantasy_art.png`},{name:"Line Art",style:"line-art",icon:`${S}/assets/images/image_chat/line_art.png`},{name:"Analog Film",style:"analog-film",icon:`${S}/assets/images/image_chat/analog_film.png`},{name:"Neon Punk",style:"neon-punk",icon:`${S}/assets/images/image_chat/neon_punk.png`},{name:"Isometric",style:"ısometric",icon:`${S}/assets/images/image_chat/isometric.png`},{name:"Low Poly",style:"low-poly",icon:`${S}/assets/images/image_chat/low_poly.png`},{name:"Origami",style:"origami",icon:`${S}/assets/images/image_chat/origami.png`},{name:"Cinematic",style:"cinematic",icon:`${S}/assets/images/image_chat/cinematic.png`},{name:"3D Model",style:"3d-model",icon:`${S}/assets/images/image_chat/three_d_model.png`},{name:"Pixel Art",style:"pixel-art",icon:`${S}/assets/images/image_chat/pixel_art.png`}],tools:[{id:1,name:"Remove Background",description:"Extract the main subject from a image with incredible accuracy.",video:`${S}assets/videos/remove-background-demo.mp4`,actionCode:"remove-background"},{id:2,name:"Remove Text",description:"Remove text from any image.",video:`${S}assets/videos/remove-text-demo.mp4`,actionCode:"remove-text"},{id:3,name:"Upscale",description:"Upscale your image by 2× or 4× with in seconds.",video:`${S}assets/videos/Enhance.webm`,actionCode:"image-upscaling"},{id:4,name:"Replace Background",description:"Teleport anything, any where with AI.",video:`${S}assets/videos/ReplaceBackground.webm`,actionCode:"replace-background"}],editTools:[{credit:1,id:"image-upscaling",image:!0,mask:!1,name:"Image Upscaling",prompt:!1,size:!0,explanation:"Select image magnification:",sectionWidth:90},{credit:1,id:"reimagine",image:!0,mask:!1,name:"Variation",prompt:!1,size:!1,explanation:null,sectionWidth:null},{credit:4,id:"remove-background",image:!0,mask:!1,name:"Remove Background",prompt:!1,size:!1,explanation:"Remove background from this image",sectionWidth:65},{credit:4,id:"remove-text",image:!0,mask:!1,name:"Remove Text",prompt:!1,size:!1,explanation:"Remove all text from the image",sectionWidth:60},{credit:6,id:"replace-background",image:!0,mask:!1,name:"Replace Background",prompt:!0,size:!1,explanation:null,sectionWidth:90}],pinnedContextPrompts:{reading:[42,43],writing:[45,56]},contextBlacklist:{"www.google.com":{selectors:["textarea[role='combobox']"]}},ExtensionBrowser:I??chrome??{},Browser:F?I??chrome??{}:ce,api_call_try:0,api_call_max_try:4,reply_prompts:{getEmailIntent:64,getEmailKeyPoints:65,getRelatedSuggestions:66,askAiReply:63},default_prompt_settings:{format:{model:"model_settings.format.items",label_before:"model_settings.format.html",label:"model_settings.format.title",model_element_before:"html",model_element:"title",model_prefix:"prefix",model_default:"prompt_settings.format",default:"essay",type:"radio"},tone:{model:"model_settings.tone.items",label_before:"model_settings.tone.html",label:"model_settings.tone.title",model_element_before:"html",model_element:"title",model_prefix:"prefix",model_default:"prompt_settings.tone",default:"formal",type:"radio"},length:{model:"model_settings.length.items",label_before:"model_settings.length.html",label:"model_settings.length.title",model_element_before:"html",model_element:"title",model_prefix:"prefix",model_default:"prompt_settings.length",default:"short",type:"radio"},lang:{model:"storage.Local.languages",no_translate:!0,model_element:"title",model_prefix:"name",model_default:"settings.language_detail.name",type:"select",label:"Language"}},pageReadOptions:[{id:"summarize",label:"Summarize",prompt:"Please provide a concise summary of the following content:",description:"Get a brief overview of the main points and key takeaways",requireNavigateTo:"chat"},{id:"concepts",label:"Clarify key concepts",prompt:"Please identify and explain the key concepts from the following content:",description:"Break down complex ideas and terminology into simpler explanations",requireNavigateTo:"chat"},{id:"assumptions",label:"Identify Assumptions",prompt:"Please identify and explain the underlying assumptions in the following content:",description:"Uncover implicit beliefs and premises that shape the content",requireNavigateTo:"chat"},{id:"author",label:"Learn about author",prompt:"Please analyze and explain what we can learn about the author from the following content:",description:"Analyze writing style, perspective, and potential background of the author",requireNavigateTo:"chat"},{id:"keypoints",label:"Key Points",prompt:"Please identify and explain the key points from the following content:",description:"Extract and explain the most important arguments and evidence",requireNavigateTo:"chat"},{id:"related_news",label:"Find related news",prompt:"Please suggest and find relevant news articles from web related to the main topics in this content:",description:"Discover current news articles and updates on similar topics",requireNavigateTo:"web_search",search_prefix:"related news"},{id:"related_videos",label:"Watch related videos",prompt:"Please suggest relevant videos and documentaries that would complement or expand upon the topics in this content only prefer youtube videos:",description:"Find educational videos and documentaries to deepen understanding",requireNavigateTo:"web_search",search_prefix:"related youtube videos"}],scroll_tolerance:200},w={switchbar:"chat",color_mode:"auto",ai_mode:"local",ai_key:null,language:pe(),language_name:null,language_detail:{},send_cmd:"enter",sidebar_cmd:"ctrl+y",color_mode_cmd:"ctrl+shift+l",fullscreen_cmd:"ctrl+shift+f",sidebar_show_icon:!0,sidebar_position:"right",sidebar_space:"overlay",search:!0,search_ask_mode:"manuel",youtube:!0,youtube_summarize_mode:"always",ai_model:d.ai_default_model,web_access:!1,context_reading:!0,context_reading_show_cmd:"ctrl",context_menu_shortcut_cmd:"ctrl+j",context_writing:!0,context_writing_input:!0,email_assistant:!0,speech_send:"always",voice_id:null};function pe(){try{let e=navigator.language||(navigator.userLanguage??"en");return-1!=e.indexOf("-")&&(e=e.split("-")[0]),-1!=e.indexOf("_")&&(e=e.split("_")[0]),e}catch{return"en"}}class he{marked;count;constructor(){this.marked=new oe(re({langPrefix:"hljs language-",highlight(e,t,a){const n=Y.getLanguage(t)?t:"plaintext";return Y.highlight(e,{language:n}).value}})),this.marked.Renderer.prototype.paragraph=e=>"string"==typeof e?e+"\n":e.text+"\n",this.marked.Renderer.prototype.link=({href:e,title:t,text:a})=>{let n="";typeof t<"u"&&(n='title="'+t+'" ');let i="";typeof e<"u"&&(i='href="'+e+'" ');let o="";-1!==e.indexOf("://")&&(o='target="_blank" ');let s=l.filenameByType(e);return"image"==s?`<a ${o} ${i} ${n} class="ait-no-underline ait-flex ait-max-h-auto ait-max-w-xs"><img src="${a}" class="ait-max-h-auto ait-max-w-xs ait-border-[var(--ait-link-color)] ait-border ait-border-4 ait-rounded" ${n}/></a>`:"video"==s?`<video controls class="ait-border-[var(--ait-link-color)] ait-border ait-border-4 ait-rounded ait-max-h-auto ait-max-w-xs"> <source src="${a}">Your browser does not support the video tag. </video>`:"audio"==s?`<audio controls class="ait-max-h-auto ait-max-w-xs"> <source src="${a}">Your browser does not support the video tag. </audio>`:`<a ${o} ${i} ${n} > ${a} </a>`},this.marked.Renderer.prototype.table=e=>{let t="",a="";for(let l=0;l<e.header.length;l++)a+=this.marked.Renderer.prototype.tablecell(e.header[l]);t+=this.marked.Renderer.prototype.tablerow({text:a});let n="";for(let l=0;l<e.rows.length;l++){const t=e.rows[l];a="";for(let e=0;e<t.length;e++)a+=this.marked.Renderer.prototype.tablecell(t[e]);n+=this.marked.Renderer.prototype.tablerow({text:a})}return n&&(n=`<tbody>${n}</tbody>`),'<div class="ait-responsive-table"><table>\n<thead>\n'+t+"</thead>\n"+n+"</table></div>\n"},this.marked.Renderer.prototype.tablerow=({text:e})=>`<tr>\n${e}</tr>\n`,this.marked.Renderer.prototype.tablecell=e=>{const t=this.marked.parseInline(e.text),a=e.header?"th":"td";let n="vertical-align: top;",l="ait-min-w-[55px] ait-p-2";return(e.align?`<${a} align="${e.align}" style="${n}" class="${l}">`:`<${a}  style="${n}" class="${l}">`)+t+`</${a}>\n`}}pretty(e,t=!0){if(null===e||typeof e>"u"||"object"==typeof e||"function"==typeof(e=e.toString()).indexOf&&-1!==e.indexOf("hljs language"))return e;let a;function n(e){let t=e.match(/\*\*(.*?)\*\*/g);return t&&t.forEach((t=>{let a=t.replace(/\*\*/g,"");a="<strong>"+a+"</strong>",e=e.replace(new RegExp(l.RegexSpecialFixer(t),"g"),a)})),e}return n(t?this.marked.parseInline(this.marked.parse(e.replace(/^[\u200B\u200C\u200D\u200E\u200F\uFEFF]/,""),a).toString()).toString():this.marked.parse(e.replace(/^[\u200B\u200C\u200D\u200E\u200F\uFEFF]/,""),a).toString())}}const _e=new he,W=fe(),V={emit:(e,t)=>W.emit(e,t),on:(e,t)=>W.on(e,t),off:(e,t)=>W.off(e,t)},ee={QUESTION:{START:"<a href='javascript:;' class=\"ait-action-question\">",END:"</a>"},SUGGESTION:{START:"<a href='javascript:;' class=\"ait-action-suggestion\">",END:"<span>→</span></a>"}};console.time();const Q={chats:{},ai_all_response:{},ai_response:[],instance:null,aborting:{},long_prefix:"<#Finished#>",count:0,extra_key:null,expires:{},ai_wait:!1,prompt_prefix:"##",last_stream:"",is_group_chat:!1,uuid_extra_data:{},debounceTimeout:null,pendingUpdates:new Map,debounce(e,t){let a;return(...n)=>{clearTimeout(a),a=setTimeout((()=>e.apply(this,n)),t)}},async processPendingUpdates(e,t){if(!this.pendingUpdates.has(`${e}-${t}`))return;const a=this.pendingUpdates.get(`${e}-${t}`);this.pendingUpdates.delete(`${e}-${t}`),a&&a.length&&(await this.setDataStorage(t,e),l.scrollToBottom())},queueUpdate(e,t,a,n){const l=`${e}-${t}`;this.pendingUpdates.has(l)||this.pendingUpdates.set(l,[]);const i=this.pendingUpdates.get(l);i&&(i.push({content_index:a,content:n}),this.debounce((()=>this.processPendingUpdates(e,t)),150)())},async chat(e="",t=null,a="ai_chat",n="__all",i=!1,o=!1,s=null,r=!1,c={},u=!1,p=0){var g,m;if(this.ai_wait)return;typeof this.aborting[n]<"u"&&(this.aborting[n]=null);let _=await l.Browser().storage.local.get(["settings","credit_detail","expires","ai_image_url","ai_chat_ids","context_data","selected_agent",a]);if(await l.Browser().storage.local.set({ai_ask:null}),l.notUndefined(_,"context_data")&&(null==c||!c.mode)){const t=window.location.pathname,s=null==(g=_.context_data)?void 0:g.mode,r={chatwithfile:"chat_with_file.html"};s&&r[s]&&t.endsWith(r[s])&&(null!=(m=_.context_data)&&m.contextData&&(e=`##HIDDEN_CONTEXT_START##${_.context_data.contextData.context}##HIDDEN_CONTEXT_END##`+e),a="ai_single",n=l.SHA1("chat_with_file"),i=!1,o=!1)}this.key_detail=await l.Browser().storage.local.get(["uuid_hopekey","uuid_search"]),this.settings=l.notUndefined(_,"settings"),null==t&&(t=d.ai_default_model);let f=this.settings.ai_image_model==t?"image":"text";null===t&&(t=this.settings.ai_model),this.waiting(!0),this.credit_detail=l.notUndefined(_,"credit_detail"),typeof this.ai_all_response[n]>"u"&&(this.ai_all_response[n]={}),typeof this.ai_all_response[n][a]>"u"&&(this.ai_all_response[n][a]=[]);let h=l.notUndefined(_,`${a}`);null!=typeof _.expires&&(this.expires=_.expires);let y={};"string"==typeof h?(y=JSON.parse(h),Object.keys(y).length>0&&Object.keys(y).forEach((e=>{typeof this.ai_all_response[e]>"u"&&(this.ai_all_response[e]={}),this.ai_all_response[e][a]=Object.values(y[e])}))):(y=h,null!=y&&("ai_chat"==a?this.ai_all_response[n][a]=Object.values(y):typeof y[n]<"u"&&(this.ai_all_response[n][a]=Object.values(y[n])))),"ai_single"==a&&1==i&&0==r&&typeof this.ai_all_response[n]<"u"&&typeof this.ai_all_response[n][a]<"u"&&(this.ai_all_response[n][a]=[],Object.keys(this.ai_all_response[n][a]).length),this.uuid_search=l.notUndefined(this.key_detail,"uuid_search"),this.hopekey=l.notUndefined(this.key_detail,"uuid_hopekey"),document.querySelector("#aitopia-container");let w=`${d.api_url}/ai/send`;if(null!=this.credit_detail){let e=t;if(this.settings.web_access&&(e="GPT-4o"),typeof this.credit_detail[e]<"u"&&this.credit_detail[e].balance<this.credit_detail[e].cost&&-999!=this.credit_detail[e].credit&&"api"!==this.settings.ai_mode)return this.ai_all_response[n][a].forEach(((e,t)=>{"limit"==e.role&&delete this.ai_all_response[n][a][t]})),this.ai_all_response[n][a]=Object.values(this.ai_all_response[n][a]),this.ai_all_response[n][a].push({item:"Usage Limit please upgrade plan.",role:"limit",model:t}),await this.setDataStorage(a,n),void(await this.waiting(!1))}let b=this.ai_all_response[n][a],x=0,v=!1;Object.keys(this.ai_all_response[n][a]).length>0&&!l.notUndefined(c,"search")&&this.ai_all_response[n][a].forEach(((e,t)=>{x++,b!=x&&1==this.ai_all_response[n][a][t].loading&&(this.ai_all_response[n][a][t].loading=!1,v=!0),"limit"==e.role&&(delete this.ai_all_response[n][a][t],this.ai_all_response[n][a]=Object.values(this.ai_all_response[n][a]),v=!0)})),u&&(this.is_group_chat=!0,v=!0),v&&await this.setDataStorage(a,n);let S="";this.count++;let k="user";"image"==f&&(k="image"),(null==c||"object"!=typeof c)&&(c={}),(String(e).trim().length>0||"image"==k)&&0==r&&(c.prompt_mode=o,0==p&&this.ai_all_response[n][a].push({item:e,role:k,model:t,title:s,loading:"image"==k,extra_data:c})),"image"!=f&&null!=l.notUndefined(_,"ai_image_url")&&""!==l.notUndefined(_,"ai_image_url")&&typeof c.search_mode>"u"&&(this.settings.web_access=!1,c.ai_image_url=l.notUndefined(_,"ai_image_url"),await l.Browser().storage.local.set({ai_image_url:null}),await l.Browser().storage.local.remove(["ai_image_url"]));let O=l.ChatId(a,n),L={history:this.ai_all_response[n][a],text:e,model:t,stream:"image"!=f,uuid_search:this.uuid_search,mode:a,prompt_mode:o,extra_key:n,extra_data:c,chat_id:O,language_detail:this.settings.language_detail,is_continue:r};this.uuid_extra_data={chat_id:L.chat_id,history:L.history,mode:a},this.settings.ai_key&&"api"==this.settings.ai_mode&&(L.token=this.settings.ai_key),this.settings.language&&(L.lang_code=this.settings.language);let U=this.ai_all_response[n][a].length;("image"==f||l.notUndefined(c,"search"))&&(U-=1),U<0&&(U=0);let E="";1==r&&this.ai_all_response[n][a].forEach(((e,t)=>{typeof e.finish_reason<"u"&&"length"==e.finish_reason&&(e.finish_reason="",U=t,S=E=e.item)})),this.ai_all_response[n][a].forEach(((e,t)=>{typeof e.finish_reason<"u"&&"length"==e.finish_reason&&(e.finish_reason="stop")})),"image"!=f&&(this.ai_all_response[n][a][U]={item:E,role:"system",model:t,loading:!0,title:s,extra_data:c}),await this.setDataStorage(a,n),this.aborting[n]=new AbortController;let T=document.querySelectorAll("#ait-stop-chat-"+a),C=document.querySelectorAll("#ait-stop-chat-"+a+" button");null!=C&&null!=T&&(T.forEach((e=>{e.classList.remove("ait-hide"),e.classList.add("ait-show")})),this.aborting[n].signal.addEventListener("abort",(()=>{"ai_single"==a?Object.values(this.ai_all_response[n][a]).length>0&&this.ai_all_response[n][a].forEach(((e,t)=>{this.ai_all_response[n][a][t].loading=!1,this.ai_all_response[n][a][t].stop=!0})):(this.ai_all_response[n][a][U].loading=!1,this.ai_all_response[n][a][U].stop=!0),this.setDataStorage(a,n),this.waiting(!1)})),Object.keys(C).length>0&&C.forEach((e=>{e.onclick=e=>{this.aborting[n].abort(),this.waiting(!1);let t={force:1};this.is_group_chat&&(t.extra_data=this.uuid_extra_data),l.sendMessage("uuid",t),T.forEach((e=>{e.classList.add("ait-hide"),e.classList.remove("ait-show")}))}})));let B=null;return await this.setDataStorage(a,n),-1!==["image"].indexOf(f)?await this.imageApi(a,t,n,L,U,T,B,w,S).finally((async()=>await this.waiting(!1))):1==l.notUndefined(this.settings,"web_access")&&-1===["image"].indexOf(t)&&0==r&&"__all"==n&&!l.notUndefined(c,"search")&&e.length<=2048&&0==o?(l.Browser().web_access_mode=a,l.Browser().web_access_extra_key=n,l.sendMessage("GoogleSearchCall",e,"GoogleSearchCallback","tabs")):(l.notUndefined(_,"selected_agent._listkey")&&!o&&(L.extra_data.agent_id=l.notUndefined(_,"selected_agent._listkey")),await this.aiApi(a,t,n,L,U,T,B,w,S,this).finally((async e=>{await this.waiting(!1)})))},async AiSync(e,t,a=d.ai_default_model,n){let i={history:e,text:t,model:a,stream:!1,uuid_search:this.uuid_search,mode:"ai_chat",prompt_mode:!1,extra_key:"__all",extra_data:n??{search_fixer:!0},chat_id:null,language_detail:this.settings.language_detail};return l.apiCall(`${d.api_url}/ai/send`,i,"POST",-1).then((e=>l.notUndefined(e,"choices.0.message.content")??null))},async imageApi(e,t,a,n,i,o,s,r,c){let d=n.extra_data.image_count??1;if(this.credit_detail[t]&&d*(this.credit_detail[t].cost??1)>this.credit_detail[t].balance&&-999!=this.credit_detail[t].credit&&"-999"!=this.credit_detail[t].credit)return this.ai_all_response[a][e].forEach(((t,n)=>{"limit"==t.role&&delete this.ai_all_response[a][e][n]})),this.ai_all_response[a][e][i].loading=!1,this.ai_all_response[a][e]=Object.values(this.ai_all_response[a][e]),this.ai_all_response[a][e].push({item:"Usage Limit please upgrade plan.",role:"limit",model:t}),void(await this.setDataStorage(e,a));let u={role:"image",item:n.text,loading:!0,images:[]};this.ai_all_response[a][e][i]={...this.ai_all_response[a][e][i],...u},await this.setDataStorage(e,a);let p="/ai/image";return null!=n.extra_data.action&&(p="/ai/image_editing"),l.apiCall(p,n,"POST",-1).then((async r=>{let c=r;typeof c.images>"u"&&(c.images=[]),typeof c.seed>"u"&&(c.seed=null),u.images=c.images||[],u.loading=!1,u.seed=c.seed||null,this.ai_all_response[a][e][i]={...this.ai_all_response[a][e][i],...u},typeof c<"u"&&typeof c.message<"u"&&this.ai_all_response[a][e].push({item:c.message??null,role:c.type??"error",model:t,finish_reason:s,loading:!1}),await this.setDataStorage(e,a);let d={force:1};return this.is_group_chat&&(d.extra_data=this.uuid_extra_data),l.sendMessage("uuid",d),null!=o&&o.forEach((e=>{e.classList.add("ait-hide"),e.classList.remove("ait-show")})),null!=n.extra_data.action&&l.Browser().storage.local.get("image_settings").then((e=>{e.image_settings.image=null,e.image_settings.action=null,l.Browser().storage.local.set(e)})),this.ai_all_response[a][e][i]})).catch((e=>{console.log(e)}))},async aiApi(e,t,a,n,i,o,s,r,c,d=this){let u=0;return fetch(r,{headers:{accept:"text/plain",hopekey:this.hopekey??null},body:JSON.stringify(n),method:"POST",signal:this.aborting[a].signal}).then((async t=>{const n=t.body.getReader();let l=async()=>n.read().then((async({value:t,done:n})=>{if(await d.streamFormatter(t,n,a,e,i,u,d),u++,!n)return await l()})).catch((t=>{if(d.waiting(!1),t instanceof DOMException&&"AbortError"==t.name)return null!=document.querySelector(".ai_loading")&&document.querySelector(".ai_loading").classList.remove("ai_loading"),void(d.ai_all_response[a][e][i]._abort=!0);"network error"==t.message?(d.ai_all_response[a][e][i].loading=!1,d.ai_all_response[a][e][i]._error=JSON.stringify(t),console.log(t.message)):(d.ai_all_response[a][e][i].loading=!1,console.log(t.message,t.toString(),t),console.log(d.ai_all_response[a][e]),console.log(c??null),d.ai_all_response[a][e][i]._error=JSON.stringify(t)),d.setDataStorage(e,a)}));return await l()})).then((e=>{})).catch((t=>{this.waiting(!1),this.ai_all_response[a][e][i].loading=!1,this.ai_all_response[a][e][i].loading=!1;let n='<span class="ait-text-red-600">'+l.__("(Internet connection lost. Please try again)")+"</span>";null!=o&&o.forEach((e=>{e.classList.add("ait-hide"),e.classList.remove("ait-show")})),c.length>0&&(n=c+"\n\n"+n),this.ai_all_response[a][e][i].item=n,d.ai_all_response[a][e][i]._error=JSON.stringify(t),this.setDataStorage(e,a),console.log(t)}))},async setData(e,t,a=!0,n=this){let l={};return l[e]={},new Promise((i=>{null===n.instance&&i(!1);let o=n.instance[e];"string"==typeof o&&null!=o&&(o=JSON.parse(o)),"__all"!=t&&null!=t&&"ai_chat"!=e&&a?(null!=o&&Object.keys(o).length>0&&Object.keys(o).forEach((t=>{l[e][t]=o[t]})),typeof n.ai_all_response[t]<"u"&&typeof n.ai_all_response[t][e]<"u"&&(l[e][t]=n.ai_all_response[t][e])):l[e]=n.ai_all_response[t][e],n.instance.storage&&n.instance.storage.Local&&(n.instance.storage.Local[e]=l[e]),n.instance[e]=l[e],n.instance.$root&&(n.instance.$root[e]=l[e]),n.instance.$data&&(n.instance.$data[e]=l[e]),i(l)}))},async setDataStorage(e,t,a=!0){let n={};return n[e]={},await l.Browser().storage.local.get(e).then((async i=>{let o=i[e];return"string"==typeof o&&null!=o&&(o=JSON.parse(o)),"__all"!=t&&null!=t&&"ai_chat"!=e&&a?(null!=o&&Object.keys(o).length>0&&Object.keys(o).forEach((t=>{n[e][t]=o[t]})),typeof this.ai_all_response[t]<"u"&&typeof this.ai_all_response[t][e]<"u"&&(n[e][t]=this.ai_all_response[t][e]),Object.keys(this.ai_all_response).forEach((t=>{typeof this.ai_all_response[t][e]<"u"&&(n[e][t]=this.ai_all_response[t][e])}))):n[e]=this.ai_all_response[t][e],await l.Browser().storage.local.set(n).then((async()=>await this.setData(e,t)))}))},async streamFormatter(e,t,a,n,i,o=0,s=this){this.last_stream=this.last_stream+(new TextDecoder).decode(e,{stream:!0}).toString();let r=this.last_stream,c=r.toString();if(r=r.replace(/"data":\{/gi,'"data": {').replace(/data:\{/gi,"data: {").replace(/"error":\{/gi,'"error": {').replace(/error:\{/gi,"error: {").replace(/\r/,"\n"),typeof r.match>"u")return void(this.ai_all_response[a][n][i].loading=!1);const d=r.match(/(\w+): \{(.*)\}/gi);if(r.match(/error: \{(.*)\}/gi),t){this.ai_all_response[a][n][i].loading=!1,await this.processPendingUpdates(a,n),await this.waiting(!1);let e={force:1};return this.is_group_chat&&(e.extra_data=this.uuid_extra_data),l.sendMessage("uuid",e),void l.scrollToBottom()}if(null==d&&!t&&0==o){let e=l.JsonParse(r);if(l.notUndefined(e,"error"))return this.ai_all_response[a][n][i].loading=!1,this.ai_all_response[a][n][i].item=l.notUndefined(e,"error.message"),this.ai_all_response[a][n][i].role="error",await this.processPendingUpdates(a,n),await this.waiting(!1),this.ai_all_response[a][n][i].item}if("object"!=typeof d||null===d||!d){this.ai_all_response[a][n][i].loading=!1;let e=l.JsonParse(r);if(null!==e){let t=l.notUndefined(e,"choices.0.delta")??l.notUndefined(e,"choices.0"),o=l.notUndefined(t,"content")??l.notUndefined(t,"message"),s=l.notUndefined(t,"role");if(l.notUndefined(e,"event_type")&&l.notUndefined(e,"metadata")){let t=this.eventStreamBuilder(e);typeof this.ai_all_response[a][n][i].events>"u"&&(this.ai_all_response[a][n][i].events={}),l.notUndefined(t,"id")&&(this.ai_all_response[a][n][i].events[t.id]=t)}s&&o&&t&&(this.ai_all_response[a][n][i].item=o.toString(),this.ai_all_response[a][n][i].role=s)}return await this.setDataStorage(n,a),await this.waiting(!1),this.ai_all_response[a][n][i].item}let u=c.split(/(\w+): (.*)$/gm);u&&u.forEach((async e=>{if(e&&typeof e<"u"){let t=e,s=l.JsonParse(e.trim());if("object"==typeof s)await this.streamToResponseData(s,a,n,i,o),this.queueUpdate(a,n,i,this.ai_all_response[a][n][i].item);else if("{"==t.substring(0,1)&&"}"==t.substring(t.length-1,t.length)){let e=l.JsonParse(t.trim());await this.streamToResponseData(e,a,n,i,o),this.queueUpdate(a,n,i,this.ai_all_response[a][n][i].item)}}}));let p=this.ai_all_response[a][n][i].item;return typeof p<"u"&&""!=p&&null!=p&&(this.last_stream=""),p},eventStreamBuilder(e){let t={};if(l.notUndefined(e,"event_type")&&l.notUndefined(e,"metadata")){let a=l.notUndefined(e,"metadata");typeof a.parameters<"u"&&delete a.parameters,t=a,t.event_type=l.notUndefined(e,"event_type"),t.event_data=l.notUndefined(e,"event_data"),t.action=l.notUndefined(e,"action"),t.created=l.notUndefined(e,"created"),t.id=l.notUndefined(e,"id")}return t},async streamToResponseData(e,t,a,n,i=0,o=this){if(l.notUndefined(e,"error.message"))return o.ai_all_response[t][a][n].loading=!1,o.ai_all_response[t][a][n].item=l.notUndefined(e,"error.message"),o.ai_all_response[t][a][n].role="error",V.emit("ai-error",l.notUndefined(e,"error.message")),await o.setDataStorage(a,t),await o.waiting(!1),o.ai_all_response[t][a][n].item;let s=l.notUndefined(e,"choices.0.delta"),r=l.notUndefined(s,"content")??"",c=l.notUndefined(e,"choices.0.finish_reason")??null;if(typeof o.ai_all_response[t]>"u"&&(o.ai_all_response[t]={}),typeof o.ai_all_response[t][a]>"u"&&(o.ai_all_response[t][a]=[]),typeof o.ai_all_response[t][a][n]>"u"&&(o.ai_all_response[t][a][n]={item:"",role:"",loading:!0}),l.notUndefined(e,"event_type")&&l.notUndefined(e,"metadata")){let i=this.eventStreamBuilder(e);typeof o.ai_all_response[t][a][n].events>"u"&&(o.ai_all_response[t][a][n].events={}),l.notUndefined(i,"id")&&(o.ai_all_response[t][a][n].events[i.id]=i)}if(o.ai_all_response[t][a][n].item+=r.toString(),d.debugMode&&console.log(l.notUndefined(e,"finish_text")),l.notUndefined(e,"finish_text"))return o.ai_all_response[t][a][n].item=l.notUndefined(e,"finish_text"),o.ai_all_response[t][a][n].role="error"===l.notUndefined(e,"type")?"error":"system",o.ai_all_response[t][a][n].prompt=l.notUndefined(e,"prompt"),o.ai_all_response[t][a][n].loading=!1,await o.setDataStorage(a,t),await o.waiting(!1),o.ai_all_response[t][a][n].item;l.notUndefined(o.ai_all_response[t][a],`${n}.model`);let u=parseInt(l.notUndefined(e,"mod")??10);return isNaN(u)&&(u=10),c&&null!==c&&(o.ai_all_response[t][a][n].finish_reason=c,V.emit("ai-finish")),r&&V.emit("ai-stream",r),i%u==0||1==i||u<=1?(await o.setDataStorage(a,t),V.emit("ai-response",o.ai_all_response[t][a][n])):await o.setData(a,t),r},linkify:e=>null==e?"":_e.pretty(e)??e,waiting:async(e=!0)=>(V.emit("ai-loading",e),0==e?document.querySelectorAll('[id*="ait-stop-chat-"]').forEach((e=>{e.classList.add("ait-hide"),e.classList.remove("ait-show")})):document.querySelectorAll('[id*="ait-stop-chat-"]').forEach((e=>{e.classList.add("ait-show"),e.classList.remove("ait-hide")})),await l.Browser().storage.local.set({ai_wait:e}).then((()=>l.scrollToBottom()))),prefixify(e){if(null==e)return"";let t=this.prompt_prefix.toString();return"function"!=typeof(e=e.toString()).replace||Object.keys(ee).forEach((a=>{let n=ee[a];Object.keys(n).forEach((l=>{let i=n[l],o=new RegExp(`\n${t}${a}_${l}${t}\n`.toString(),"gi"),s=new RegExp(`\n${t}${a}_${l}${t}`.toString(),"gi"),r=new RegExp(`${t}${a}_${l}${t}\n`.toString(),"gi"),c=new RegExp(`${t}${a} ${l}${t}\n`.toString(),"gi"),d=new RegExp(`${t}${a}_${l}${t}`.toString(),"gi");e=e.replace(o,i).replace(s,i).replace(r,i).replace(c,i).replace(d,i).replace(/##HIDDEN_CONTEXT_START##.*##HIDDEN_CONTEXT_END##/gs,"")}))})),e},async testChat(e,t,a,n,l,i=10){for(let o=0;o<i;o++){typeof this.ai_all_response[t]>"u"&&(this.ai_all_response[t]={}),typeof this.ai_all_response[t][a]>"u"&&(this.ai_all_response[t][a]=[]),this.ai_all_response[t][a]=Object.values(this.ai_all_response[t][a]);let e="";this.ai_all_response[t][a][l]&&typeof this.ai_all_response[t][a][l].item<"u"&&(e=this.ai_all_response[t][a][l].item),this.ai_all_response[t][a][l]={item:e+"TEST"+(new Date).toDateString()+"____>"+o,role:"system",model:n},await this.setData(a,t)}},streamRegExBuilder:(e,t,a=!1)=>{let n=null;try{n=t.match(e)[0]??null,null!==n&&a&&(n=n.replace(/(data|error|event|ping|finish): /,""))}catch{n=null}return n},bulkPrettier:(e,t=!1)=>(console.log(e),e&&"object"==typeof e&&Object.keys(e).forEach((a=>{typeof e[a].item<"u"&&typeof e[a].is_prettier>"u"&&null!==e[a].item&&(e[a].item=Q.prefixify(Q.linkify(e[a].item)),t&&(e[a].item=e[a].item.replace(/\n/g,"<br>")))})),e)};typeof window<"u"&&typeof document<"u"&&(window.getCookie=e=>{var t=[];if("*"==e){let e=document.cookie.split("; ").map((e=>e.split("=")))??[];return Object.fromEntries(e)}if(t=document.cookie.match(new RegExp("(^| )"+e+"=([^;]+)")))return t[2]},window.setCookie=(e,t,a,n=null)=>{var l="";if(a){var i=new Date;i.setTime(i.getTime()+24*a*60*60*1e3),l="; expires="+i.toUTCString()}null==n&&(n=window.location.host,window.location.host.split(".").length>2&&(n="."+(n=window.location.host.split(".")).slice(1).join("."))),document.cookie=e+"="+(t||"")+"; "+l+"; path=/; domain="+n+"; secure; SameSite=None"},window.eraseCookie=(e,t=null)=>{null==t&&(t=window.location.host,window.location.host.split(".").length>2&&(t="."+(t=window.location.host.split(".")).slice(1).join("."))),document.cookie=e+"=null; expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/; domain="+t});class me{notify=se.useToast({duration:5e3,position:"top"});resizeBorder=(e,t=320,a=null)=>{if(null==e)return;let n;e.classList,e.id;let l=document.createElement("div");l.classList.add("ai-el-resize"),e.append(l);const i=a=>{const l=n-a.x;n=a.x;let i=parseInt(getComputedStyle(e,"").width)+l;i>=t&&(e.style.width=`${i}px`)};return l.addEventListener("mousedown",(function(e){e.offsetX<t&&(n=e.x,document.addEventListener("mousemove",i,!1),a&&a(n))}),!1),document.addEventListener("mouseup",(function(e){document.removeEventListener("mousemove",i,!1)}),!1),n};fetchWithTimeout=(e,t={},a=6e4)=>{let n=null,l={...t};if(a>0){let e=new AbortController;n=setTimeout((()=>{e.abort(),clearTimeout(n)}),a),l.signal=e.signal}return fetch(e,l).then((function(e){return null!=n&&clearTimeout(n),e})).finally((()=>{null!=n&&clearTimeout(n)}))};NodeSearch=(e,t)=>[...e].filter((e=>-1!==e.outerHTML.indexOf(t)));logout=()=>this.apiCall("/auth/logout",{},"POST").finally((()=>(d.domain_allows.forEach((e=>{window.eraseCookie("hopekey","."+e),window.eraseCookie("ait_app","."+e),window.eraseCookie("aitopia_check_login","."+e)})),l.uuid(1).finally((()=>{this.notify&&this.notify.success(this.__("Successfully logged out."))})))));storageLocalClearAll=(e=!1)=>{let t=["token_usage","credits","licences","uuid_hopekey","uuid_search","expires","credit_usage","credit_detail","credit_detail_visual","check_extension_expire","check_extension"];return 1==e&&(t=null),chrome.storage.local.get(t).then((e=>(d.debugMode&&console.log(e),l.Browser().storage.local.remove(Object.keys(e)))))};sendMessageWindowListener=(e,t,a)=>l.sendMessageListener(e,{},t);sendMessageListener=async(e,t,a,n=!1)=>{let i=[],o=null;if(typeof e.data<"u"&&(i=e.data),o=l.messageExecute(null,e.fn,i,!1,this),o&&"function"==typeof o.then&&n){let e=await o;e&&(o=e)}return null==a?{received:!0,return_data:o}:l.messageSendResponse(o,i,t,a)};sendMessage=(e,t={},a=null,n="scripting",i="runtime",o=null)=>{let s=null!=d.runtime_id?chrome??this.Browser()??{}:this.Browser(),r={fn:e,data:{data:t,callback:a,type:n}},c=e=>({received:!0,return_data:e});if(null===d.runtime_id&&!l.notUndefined(s[i],"sendMessage"))return l.onMessageExecutePre(r,{},c);if(!(typeof s[i]>"u"||typeof s[i].sendMessage>"u"))try{return s[i].sendMessage(o??s.runtime.id??null,r,c)}catch(u){return d.debugMode&&console.log(u),l.onMessageExecutePre(r,{},c)}};onMessageListener=()=>l.notUndefined(l.Browser().runtime,"onMessage")?l.Browser().runtime.onMessage.hasListener(l.onMessageExecutePre)?new Promise((e=>e(!1))):l.Browser().runtime.onMessage.addListener(l.onMessageExecutePre):new Promise((e=>e(!1)));onMessageExecutePre=(e,t,a)=>{let n=[],i=null;return l.notUndefined(e,"data")&&(n=e.data),i=l.messageExecute(null,l.notUndefined(e,"fn")??null,n),l.messageSendResponse(i,n,t,a)};messageExecute=(e,t,a,n=!1,i={})=>{let o=null,s=a;l.notUndefined(s,"data")&&(s=s.data);let r=[],c=["object","function"],d={};if(null!=self&&(d=self),null!=t&&"function"!=typeof t&&(r="string"==typeof t?t.split("."):t,null==e)){let e=[typeof i<"u"?i:null,typeof d<"u"?d:null,typeof this<"u"?this:null,typeof ServiceWorkerGlobalScope<"u"?ServiceWorkerGlobalScope:null,typeof l<"u"?l:null,l.notUndefined(this,"Browser")?this.Browser():null];if(typeof r.forEach<"u"&&r.forEach((t=>{if(null==o){if(-1!==c.indexOf(typeof t))o=this.messageExecute(null,t,s,n);else for(const a of e)if(null!=a&&l.notUndefined(a,t)&&-1!==c.indexOf(typeof a[t])){o=this.messageExecute(null,a[t],s,n);break}}else o=o[t]??null})),"function"!=typeof o)return o??null;t=o}if(null!=e){if("object"==typeof e[t]&&typeof e[t].then>"u"||!0===n)return e[t]}else if(!0===n)return t;if("object"==typeof t&&null!=t&&"function"==typeof t.then)return t();if(null==e&&"object"==typeof t)return t;try{return null==e&&"function"==typeof t?Array.isArray(s)?t(...s):t(s):null==e&&null!=t?t:"object"==typeof e&&"function"==typeof e[t]?Array.isArray(s)?e[t](...s):e[t](s):null==e?void 0:typeof e[t]<"u"&&typeof e[t].then>"u"&&"object"==typeof e?e:Array.isArray(s)?e[t](...s):e[t](s)}catch{return null==e&&"function"==typeof t?t():null==e&&null!=t?t:null==e?void 0:typeof e[t]<"u"&&"object"==typeof e&&"function"==typeof e[t]?e[t]():"object"==typeof e&&typeof e[t].then>"u"?e:e[t]()}};messageSendResponse=(e,t,a,n,i={})=>{let o=null,s=l.notUndefined(t,"type")??"scripting",r=l.notUndefined(t,"callback")??null;if(r){o=this.messageExecute(null,t.callback,e,!0,i);let a=o.name;t.callback=o,t.callback_name=a}if(null==e)return n({received:!0,return_data:e});if("object"==typeof e&&"function"==typeof e.then){let o;return n({received:!0,return_data:e.then((e=>{if(typeof e<"u"&&typeof e.text<"u"&&(e=e.text()),typeof e<"u"&&typeof e.json<"u"&&(e=e.json()),typeof t.callback<"u"&&t.callback){let n=this.messageExecute(null,t.callback,e,!0,i),o=n.name;if(t.callback=n,t.callback_name=o,"scripting"==s)if(null==a)n(e,t);else{let i={target:{tabId:a.tab.id},function:n,args:[e,t]};l.Browser().scripting.executeScript(i).then()}else{let n=l.notUndefined(a.tab,"id")??null;null!=n&&null==d.runtime_id?(r=this.messageExecute(null,r,{result:e,data:t},!0,i),r&&r(e,t)):l.sendMessage(r,{data:{result:e,data:t}},null,"tabs","tabs",n)}}return e}))})}if(typeof t.callback<"u"&&null!=t.callback&&null!=o&&"function"==typeof t.callback){let n=this.messageExecute(null,t.callback,e,!0,i),o=n.name;if(t.callback=n,t.callback_name=o,"scripting"==s)if(null==a)n(e,t);else{let i={target:{tabId:a.tab.id},function:n,args:[e,t]};l.Browser().scripting.executeScript(i).then()}else{let n=l.notUndefined(a.tab,"id")??null;null!=n&&null==d.runtime_id?(o=this.messageExecute(null,o,{result:e,data:t},!0,i),o&&o(e,t)):l.sendMessage(o,{data:{result:e,data:t}},null,"tabs","tabs",n)}}return n({received:!0,return_data:e})};customAddListener=(e,t=[],a=[])=>{t.forEach((t=>{e[t].addListener(((e,t,n)=>{let l=!1;typeof e.status<"u"&&(t=e,e=(n=e).id),typeof t<"u"?typeof t.status<"u"&&typeof n.url<"u"&&"complete"===t.status&&-1===n.url.indexOf("chrome://")&&(l=!0):(typeof e.name<"u"||typeof e.title<"u"||Object.keys(e).length>0)&&(l=!0),l&&a.forEach((a=>{let l=!1;"function"==typeof a?a(e,t,n):(typeof window<"u"&&!1===l&&"function"==typeof window[a]&&"function"==typeof window[a].apply&&(window[a].apply(e,t,n),l=!0),typeof ServiceWorkerGlobalScope<"u"&&!1===l&&"function"==typeof ServiceWorkerGlobalScope[a]&&ServiceWorkerGlobalScope[a](e,t,n),typeof this<"u"&&!1===l&&"function"==typeof this[a]&&this[a].call(e,t,n))}))}))}))};apiCall=async(e,t={},a="GET",n=6e4,i="json",o=1)=>{null==t&&(t={}),d.debugMode&&console.log(e,t,"Call");let s={headers:{accept:"application/json",hopekey:f.Local.uuid_hopekey??null},method:a};null!=d.runtime_id&&"/extensions/app/get_key"==e&&null==s.headers.hopekey&&delete s.headers.hopekey,null==d.runtime_id&&typeof window<"u"&&"function"==typeof window.getCookie&&(s.headers.hopekey=window.getCookie("hopekey")??f.Local.uuid_hopekey??null,null==s.headers.hopekey&&delete s.headers.hopekey);let r=e;if(-1===e.indexOf("://")){if(r=`${d.api_url}${e}`,typeof f.Local<"u"){let e=f.Local;typeof e.settings<"u"&&l.notUndefined(e.settings,"language")&&(t.lang=e.settings.language)}typeof t.uuid_search>"u"&&l.notUndefined(f.Local,"uuid_search")&&(t.uuid_search=l.notUndefined(f.Local,"uuid_search")),typeof t.uuid_hopekey>"u"&&l.notUndefined(f.Local,"uuid_hopekey")&&(t.uuid_hopekey=l.notUndefined(f.Local,"uuid_hopekey")),null!=d.runtime_id?(t.v=d.version??null,t.ri=l.Browser().runtime.getManifest().id??d.runtime_id,l.notUndefined(f.Local,"check_extension_delete")&&(t.rif=!0,delete f.Local.check_extension_delete,l.Browser().storage.local.remove("check_extension_delete")),t.bt=d.build_type):t.v=d.version??null}if(Object.keys(t).length>0&&"GET"!==a&&"json"==i&&(s.body=JSON.stringify(t)),"file"===i&&Object.keys(t).length>0){let e=new FormData;Object.keys(t).forEach((a=>{e.append(a,t[a])})),s.body=e}return await l.fetchWithTimeout(r,s,n).then((e=>{try{return e.json()}catch{return e.text()}})).then((a=>{a=this.ajaxResponse(this.ajaxResponseChipper(a),0,o),d.debugMode&&console.log(e,t,a);try{return a&&"object"==typeof a&&"object"==typeof a.modal&&this.announcementModal(a.modal),a}catch{return a}})).catch((i=>d.api_call_try<d.api_call_max_try&&-1===r.indexOf("languages/lang/sync")?setTimeout((()=>(console.log("Try",d.api_call_try,r,t,a,n,i),d.api_call_try++,l.apiCall(e,t,a,n))),3e4):d.api_call_try<2*d.api_call_max_try&&-1===r.indexOf("languages/lang/sync")?setTimeout((()=>(console.log("Try",d.api_call_try,r,t,a,n,i),d.api_call_try++,l.apiCall(e,t,a,n))),12e4):void 0))};ajaxResponse=(e,t=0,a=1)=>{if(typeof e>"u")return!1;if(1==t)return;if(typeof e.debug_time<"u"&&2!=d.debugMode)if(1==d.debugMode)console.log(e.redirect_uri,e.debug_time);else{let t={[e.redirect_uri]:e.debug_time};d.debug_time=Object.assign(d.debug_time,t)}let n={};return typeof e.languages<"u"&&(n.languages=e.languages,typeof f.Local<"u"&&(f.Local.languages=e.languages),typeof e.expire<"u"&&l.Browser().storage.local.get("expires").then((t=>{n.expires=t.expires??{},"object"!=typeof n.expires&&(n.expires={}),n.expires.languages=e.expire,f.Local.expires=n.expires,l.Browser().storage.local.set({expires:n.expires}).then(d.debugMode?console.log:null)}))),typeof e.expire<"u"&&typeof e.expire.name<"u"&&typeof e.expire.time<"u"&&l.Browser().storage.local.get("expires").then((t=>{n.expires=t.expires??{},"object"!=typeof n.expires&&(n.expires={}),n.expires[e.expire.name]=e.expire.time,Number.parseInt(e.expire.time)+600>0&&(n.expires[e.expire.name]=Number.parseInt(e.expire.time)+600),f.Local.expires=n.expires,l.Browser().storage.local.set(n).then(d.debugMode?console.log:null)})),typeof e.language_variables<"u"&&typeof e.language_variables.variables<"u"&&(n.language_variables=e.language_variables.variables,typeof f.Local<"u"&&(f.Local.language_variables=e.language_variables.variables)),typeof e.data<"u"&&l.notUndefined(e.data,"eref")&&f.Local.check_extension!=d.manuel_extension_id&&(n.check_extension=l.notUndefined(e.data,"eref")??null,typeof f.Local<"u"&&(f.Local.check_extension=n.check_extension)),"object"==typeof n&&Object.keys(n).length>0&&(d.debugMode&&console.log(n,e,"STORAGE_SET"),l.Browser().storage.local.set(n).then(d.debugMode?console.log:null)),typeof e.notifications<"u"&&typeof document<"u"&&e.notifications&&Object.keys(e.notifications).forEach((t=>{t=e.notifications[t],typeof this.notify[t.type]<"u"&&this.notify[t.type](t.message)})),typeof e.data<"u"&&1==a?e.data:e};firstUpperCase=e=>`${e.substring(0,1).toUpperCase()}${e.substring(1)}`;ucFirstUpperCase=(e,t)=>{let a=e.split(t);return a.forEach(((e,t)=>{a[t]=`${e.substring(0,1).toUpperCase()}${e.substring(1)}`})),a.join(t)};JsonParse=e=>{let t=e;if(typeof e<"u"||null!=e)try{"string"==typeof e&&(t=JSON.parse(e)),"object"==typeof t&&Object.keys(t).length>0&&Object.keys(t).forEach((e=>{("object"==typeof t[e]||"string"==typeof t[e]&&(-1!==t[e].indexOf("{")&&-1!==t[e].indexOf("}")||-1!==t[e].indexOf("[")&&-1!==t[e].indexOf("]")))&&(t[e]=this.JsonParse(t[e]))}))}catch{}return t};settingsBuild=async(e=!1)=>new Promise((async(t,a)=>await l.Browser().storage.local.get(["settings","domain","languages"]).then((async a=>{if(typeof a.domain>"u"&&null!=a.domain&&l.domainByUrls(a.domain),a.settings){let e=!1;null!==a.settings.language&&(l.notUndefined(a.settings,"language_detail.lang_code")!==a.settings.language&&(e=!0),e&&null!==a.settings.language&&(w.language_detail=a.settings.language_detail=l.notUndefined(a.languages,`${a.settings.language}`),w.language_name=a.settings.language_name=l.notUndefined(a.languages,`${a.settings.language}.title`)))}return typeof a.settings>"u"?await l.Browser().storage.local.set({settings:w}).then((async()=>{console.log(!0,w.language);let e=await l.getLanguages(!0,w.language);return console.log(e),l.getActiveHistories(),await l.getModelSettings(),await l.getAiTypeModels(),await l.getVoices(),l.removeLoading(),t(w)})):(Object.keys(w).forEach((e=>{if(typeof w[e]<"u"){let t=w[e];a.settings&&typeof a.settings[e]>"u"&&(a.settings[e]=t)}})),a.settings&&l.Browser().storage.local.set({settings:a.settings}).then((async()=>{1==e&&(await l.getLanguages(!1,a.settings.language).then(),await l.getModelSettings(),await l.getAiTypeModels(),await l.getVoices(),await l.uuid(1==e?1:0))})),l.removeLoading(),t(a))}))));uuid=async(e=0,t={})=>{if(l.removeFirstLoading(),"object"==typeof e){let a=e;typeof a.extra_data<"u"&&typeof a.force<"u"&&(t=a.extra_data,e=a.force)}return new Promise((async(a,n)=>await l.Browser().storage.local.get().then((async i=>{f.Local=i,typeof i.developer<"u"&&null!=i.developer&&(l.notUndefined(i.developer,"beta_api")&&(d.api_url=`https://beta_api.${d.domain}`),l.notUndefined(i.developer,"debug_log")&&(d.debugMode=1)),l.Browser().storage.sync&&l.Browser().storage.sync.get().then((async e=>{f.Sync=e})),l.notUndefined(i,"settings")||(i.settings=w),null==i.settings&&(i.settings=w,i.settings.language=w.language,l.Browser().storage.local.set({settings:i.settings}).then()),d.debugMode&&console.log(w,365),null==typeof i.settings&&(i.settings=w),d.debugMode&&console.log(i.settings,367),typeof i.settings<"u"&&null!=i.settings&&typeof i.settings.ai_mode>"u"&&(i.settings=w);let o={ai_mode:i.settings.ai_mode,lang:i.settings.language,model:i.settings.ai_model,settings:i.settings};if(e||null==d.runtime_id&&typeof window<"u"&&(i.uuid_hopekey!=(window.getCookie("hopekey")??"nullS")||window.getCookie("aitopia_check_login"))&&(window.eraseCookie("aitopia_check_login"),e=1),e||!(typeof i.credit_usage<"u")||null==(i.uuid_hopekey??null))return"api"==o.ai_mode&&(o.ai_key=i.settings.ai_key),l.notUndefined(o.settings,"language_detail.variables")&&(delete o.settings.language_detail.variables,l.Browser().storage.local.set({settings:o.settings}).then()),typeof t<"u"&&null!==t&&Object.keys(t).length>0&&(o.extra_data=t),await this.apiCall("/extensions/app/get_key",o,"POST").then((e=>{if(!e)return;let t=e;if(typeof t.key<"u"){f.Local.uuid_hopekey=t.key;let e={licences:t.licences,credit_usage:t.credit_usage,credit_detail:t.credit_detail,credit_detail_visual:t.credit_detail_visual,image_editing:t.image_editing,google_auth_uri:t.google_auth_uri??null,user:null,email:null,uuid_hopekey:t.key,uuid_search:t.search_key,plan:t.plan.toCapitalizeCase(),pricing_page_title:t.pricing_page_title,campaign_modal_api:t.campaign_modal_api??!1};l.notUndefined(t,"domain")&&(e.domain=t.domain,l.domainByUrls(t.domain)),typeof t.show_review<"u"&&(e.show_review=t.show_review),f.Local.settings&&"free"==t.plan&&typeof f.Local.settings.web_access<"u"&&(f.Local.settings.web_access=!1,e.settings=f.Local.settings),typeof t.user<"u"&&(e.user=t.user,typeof t.user.email<"u"&&(e.email=t.user.email)),typeof t.expire<"u"&&(l.notUndefined(f.Local,"expires")||(f.Local.expires={}),f.Local.expires.credits=t.expire,e.expires=f.Local.expires,d.debugMode&&console.log(f.Local.expires),d.debugMode&&console.log(e)),typeof window<"u"&&null!=e.uuid_hopekey&&d.domain_allows.forEach((t=>{window.setCookie("hopekey",e.uuid_hopekey,360,"."+t),l.Browser().runtime.id!==d.manuel_extension_id&&l.Browser().runtime.id&&window.setCookie("eref",l.Browser().runtime.id,360,"."+t),window.setCookie("ait_app",!0,360,"."+t),window.eraseCookie("aitopia_check_login","."+t)})),l.Browser().storage.local.set(e).then((()=>l.removeLoading())),f.Local=Object.assign(f.Local,e)}return a(t)})).catch((e=>(console.log(e),n())));l.removeLoading()}))))};pricingDetail=(e=!1)=>l.Browser().storage.local.get().then((t=>{if(f.Local=t,typeof t.packages<"u"&&(null==t.packages||""==t.packages)&&delete t.packages,typeof t.packages>"u"||1==e)return this.apiCall("/extensions/app/get_pricing",null,"POST").then((e=>{let t=e;if(t&&typeof t.packages<"u"){let e=t;typeof e.expire<"u"&&delete e.expire,f.Local=Object.assign(f.Local,e),typeof f.Local.expires>"u"&&(f.Local.expires={}),f.Local.expires.packages=t.expire,l.Browser().storage.local.set(e).then()}}))}));ajaxResponseChipper=e=>{if("string"!=typeof e)return e;try{return JSON.parse(D.AES.decrypt(e,"",{format:this.CryptoJSAesJson}).toString(D.enc.Utf8))}catch(t){throw console.log(t),"error"}};CryptoJSAesJson={stringify:function(e){var t={ct:e.ciphertext.toString(D.enc.Base64)};return e.iv&&(t.iv=e.iv.toString()),e.salt&&(t.s=e.salt.toString()),e.key&&(t.k=e.key.toString()),JSON.stringify(t)},parse:function(e){try{let n=D;var t=JSON.parse(e);if("string"==typeof t&&(t=JSON.parse(t)),null==t)return e;var a=n.lib.CipherParams.create({ciphertext:n.enc.Base64.parse(t.ct)});return t.iv&&(a.iv=n.enc.Hex.parse(t.iv)),t.s&&(a.salt=n.enc.Hex.parse(t.s)),t.k&&(a.key=n.enc.Hex.parse(t.k)),a}catch(n){throw console.log(n),"error"}}};_i;AesEnCrypt(e,t=null){let a=D;var n;return this._i=a.PBKDF2(this.MD5(t??d.hello_world_test),this.SHA1(t??d.hello_world_test),{keySize:8,iterations:100}),a.AES.encrypt(e,this._i,{iv:this._i,padding:a.pad.Pkcs7,mode:a.mode.CBC,hasher:a.algo.SHA256}).toString()}AesDeCrypt(e,t=null){let a=D;var n;return null==this._i&&(this._i=a.PBKDF2(this.MD5(t??d.hello_world_test),this.SHA1(t??d.hello_world_test),{keySize:8,iterations:100})),a.AES.decrypt(e,this._i,{iv:this._i,padding:a.pad.Pkcs7,mode:a.mode.CBC,hasher:a.algo.SHA256}).toString(a.enc.Utf8)}copyClipboard=e=>{let t=document.querySelector("#ait_clipboard");t.value=e,t.focus(),t.select(),document.execCommand("copy",!1,e),t.value="",this.notify&&this.notify.success(this.__("Copied."))};openPage=e=>{null!=d.runtime_id?l.Browser().tabs.create({url:e.url}).then():0===e.url.indexOf(`.${d.main_dir}`)||0===e.url.indexOf(`${d.main_dir}`)?window.location=e.url.replace(`.${d.main_dir}`,"").replace(`${d.main_dir}`,"").replace(".html",""):window.location=e.url};messageCallback(e,t){e(t)}notUndefinedBuilder=(e,t)=>"object"==typeof e&&null!==e&&typeof e[t]<"u"?e[t]:!1!==t.indexOf(".")?(t.split(".").forEach((t=>{t=t.replace("###","."),typeof e<"u"&&e&&(e=typeof e[t]<"u"?e[t]:null)})),e):!!(typeof e<"u"&&e&&typeof e[t]<"u")&&e[t];notUndefined=(e,t)=>{if(null==t)return!1;if("string"==typeof t)return this.notUndefinedBuilder(e,t);if("object"==typeof t){let a=!0;return null!=t?t.forEach((t=>{this.notUndefinedBuilder(e,t)||(a=!1)})):a=!1,a}return null};SHA1=e=>(e+="_crypt",D.SHA1(e).toString());MD5=e=>(e+="_md5",D.MD5(e).toString());isPinned=e=>{if(null!=e&&document.querySelector(".setup_page #check_toolbar")){let a=document.querySelector(".setup_page #check_toolbar");if(1==e.isOnToolbar){a.value=e.isOnToolbar;var t=new Event("change");a.dispatchEvent(t)}}};minifierExpand=(e,t)=>{let a={};return e&&t?(Object.keys(e).forEach((n=>{let l=e[n];l&&Object.keys(l).forEach((e=>{let i=l[e];typeof a[n]>"u"&&(a[n]={}),a[n][t[e]]=this.JsonParse(i)}))})),a):e};filenameByType(e){if("string"!=typeof e)return!1;const t=e.match(/\.([a-zA-Z0-9]+)(?:\?|#|$)/);if(!t)return!1;const a={excel:["xlsx","xls"],word:["doc","docx"],powerpoint:["pptx","ppt"],pdf:["pdf"],image:["jpg","jpeg","webp","png","tiff","svg","gif","avif","apng"],video:["webm","mkv","flv","flv","vob","ogv","ogg","drc","gif","gifv","mng","avi","MTS","M2TS","TS","mov","qt","wmv","yuv","rm","rmvb","viv","asf","amv","mp4","m4p","m4v","mpg","mp2","mpeg","mpe","mpv","mpg","mpeg","m2v","m4v","svi","3gp","3g2","mxf","roq","nsv","flv","f4v","f4p","f4a","f4b"],zipper:["zip","rar","7z"],audio:["mp3","wav","ogg","flac","aac","wma","m4a","ape","alac","aiff","mid","amr","pcm","au","ra","aac","ac3","dts","mka","opus","midi","3ga","webm","caf","m4r","tta","wv"],code:["php","html","css","js","py","java","c","cpp","h","hpp","xml","json","sql","rb","swift","kt","pl","go","ts","dart","sh","bat","ps1"]},n=t[1].toLowerCase();for(const[l,i]of Object.entries(a))if(i.includes(n))return l;return!1}filenameByFaIcon(e,t=null){let a=null;const n={excel:"#1d6f42",word:"#41A5EE",powerpoint:"#D04423",pdf:"#f40f02"};let i=l.filenameByType(e);return i?(a=i,null==t&&(t=n[i]??t),{name:a,color:t}):(null==a&&(a="lines"),""==t&&(t=null),{name:a,color:t})}async getAiTypeModels(e=!1){return await new Promise((async(t,a)=>await l.Browser().storage.local.get("ai_type_models").then((async a=>{if(typeof a.ai_type_models<"u"&&0==e&&null!=a.ai_type_models&&Object.keys(a.ai_type_models).length>0)return await t(a.ai_type_models);let n="/ai/ai_models";d.version&&(n+="/"+l.toSeoUrl(d.version)),await l.apiCall(n,{},"POST").then((async e=>{if(!e)return setTimeout(l.getAiTypeModels,1e3);e=l.minifierExpand(e,e.schema),await l.Browser().storage.local.set({ai_type_models:e});let t={};return e&&(Object.values(e).forEach((e=>{Object.values(e).forEach((e=>{t[e.model_id]=e}))})),await l.Browser().storage.local.set({ai_models:t})),e})),t(a)}))))}async getModelSettings(e=!1){return await new Promise((async(t,a)=>await l.Browser().storage.local.get("model_settings").then((async a=>{if(typeof a.model_settings<"u"&&0==e&&null!=a.model_settings&&Object.keys(a.model_settings).length>0)return await t(a.model_settings);await l.apiCall("/ai/model_settings",{},"POST").then((async e=>e?(await l.Browser().storage.local.set({model_settings:e}),e):setTimeout((()=>l.getModelSettings(!0)),1e3))),t(a)}))))}async getVoices(e=!1){return await new Promise((async(t,a)=>await l.Browser().storage.local.get("voices").then((async a=>{if(typeof a.voices<"u"&&0==e&&null!=a.voices&&Object.keys(a.voices).length>0)return await t(a.voices);await l.apiCall("/ai/voices",{},"POST").then((async e=>e?(await l.Browser().storage.local.set({voices:e}),e):setTimeout((()=>l.getVoices(!0)),1e3))),t(a)}))))}slugify=e=>e.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"");vueDefaultChecker(e,t,a,n,i=null,o=!0){if(a=l.notUndefined(a,l.notUndefined(n,"model_prefix")),0!=o)return a===i;if(null!=i&&null!=a)return a!=i?null:i;let s=l.notUndefined(e,t);if(null!=s)return s;let r=s??l.notUndefined(e,l.notUndefined(n,"model_default"))??i??l.notUndefined(n,"default"),c=!0;return typeof a<"u"&&(c=a==r),0==o?typeof r>"u"?null:r:(1==c&&null!=r&&l.notUndefined(f.Local,t),c)}autoHeightTextArea(e,t=null){e.style.height="unset",null==t&&(t=e.style.maxHeight.match(/[-+]?([0-9]*\.[0-9]+|[0-9]+)/)[0]??200),t<=e.scrollHeight&&(e.style.height=e.scrollHeight+"px")}getReadableFileSizeString(e){var t=-1,a=[" kB"," MB"," GB"," TB","PB","EB","ZB","YB"];do{e/=1024,t++}while(e>1024);return Math.max(e,.1).toFixed(2)+a[t]}__(e,t="tr"){if(null==e)return e;let a=D.SHA1(e).toString(),n=d.lang_cache_type;return null!=w&&"object"==typeof f.Local.languages&&typeof w.language<"u"&&null!==f.Local.languages&&null!==w.language&&typeof f.Local.languages[w.language]<"u"&&(null==w.language_name||""==w.language_name)&&typeof f.Local.languages[w.language].name<"u"&&typeof f.Local.settings<"u"&&(l.notUndefined(f.Local,"settings.language")&&(w.language=l.notUndefined(f.Local,"settings.language")),f.Local.settings.language_name=w.language_name=f.Local.languages[w.language].name,f.Local.settings.language_detail=w.language_detail=f.Local.languages[w.language],l.Browser().storage.local.set({settings:f.Local.settings}).then()),typeof f<"u"&&null!==w.language_name&&typeof f[n]<"u"&&l.notUndefined(f[n],"language_variables")&&typeof f[n].language_variables[a]<"u"?f[n].language_variables[a]:e=this.setLangVar(a,e)}async getLanguages(e=!1,t=null,a=null){let n=d.lang_cache_type;t=t??f[n].settings.language??w.language;let i=!1;if(typeof f[n].languages<"u"&&(0==Object.keys(f[n].languages??{}).length||null==f[n].languages||"{}"==f[n].languages)&&(delete f[n].languages,delete f[n].language_variables,delete f[n].language_var_sync),typeof f[n].languages>"u"||e){null!=a&&(f[n].settings.language=a.settings.language=t),typeof f[n].languages>"u"&&(f[n].languages={},i=!0),console.log(t);let e=await l.apiCall("/languages/lang/get/lang/"+t,{language:t},"POST").then((e=>{try{return console.log(e),typeof e>"u"||typeof e.languages>"u"?void 0:(e=l.JsonParse(e),i&&l.Browser().storage[n.toLowerCase()].set({languages:JSON.stringify(e.languages)}).then(),typeof e.expire<"u"&&(l.notUndefined(f.Local,"expires")||(f.Local.expires={}),f.Local.expires.languages=l.JsonParse(e.expire),l.Browser().storage[n.toLowerCase()].set({expires:f.Local.expires}).then()),f[n].language_variables=l.JsonParse(e.language_variables.variables),f[n].languages=l.JsonParse(e.languages),l.Browser().storage[n.toLowerCase()].set({language_variables:JSON.stringify(e.language_variables.variables),languages:f[n].languages}).then((e=>l.Browser().storage[n.toLowerCase()].get("settings").then((e=>(f[n].settings=e.settings??w,f[n].settings.language_name=w.language_name=f[n].languages[t].name,f[n].settings.language_detail=w.language_detail=f[n].languages[t],f[n].settings.language=w.language=t,l.Browser().storage.local.set({settings:f[n].settings}).catch((e=>console.log(e))).finally((()=>{typeof a<"u"&&null!=a&&"function"==typeof a.changeSettings&&(a.changeSettings(),1==Object.keys(a.ai_chat).length&&"function"==typeof a.newChat&&a.newChat()),l.Browser().tabs&&l.Browser().tabs.query({url:d.site+"/*"}).then((e=>{e.forEach((e=>{null!=t&&null!=l.Browser().scripting&&"complete"==e.status&&l.Browser().scripting.executeScript({target:{tabId:e.id},func:this.changeSiteLanguage,args:[t]}).catch((t=>{console.warn(t,e)})).then()}))}))}))))))))}catch(o){console.log(o)}})).catch(console.error);return console.log(e),e}}changeSiteLanguage=(e=null)=>{if(null==e){let t=f.Local;typeof t.settings<"u"&&typeof t.settings.language<"u"&&null!=t.settings.language&&(e=t.settings.language)}null!=e&&(window.lang=e,localStorage.getItem("lang")!=window.lang&&(localStorage.setItem("lang",e),localStorage.removeItem("languages"),localStorage.removeItem("language_variables")))};setLangVar(e,t){let a=d.lang_cache_type,n=!1;if(!(null==t||typeof f>"u"||typeof f[a]>"u"))return typeof f[a].language_variables>"u"&&(f[a].language_variables={}),l.notUndefined(f[a],"language_variables")||(f[a].language_variables={}),l.notUndefined(f[a].language_variables,e)||(n=!0),"string"==typeof f[a].language_variables&&null!=f[a].language_variables&&(f[a].language_variables=JSON.parse(f[a].language_variables)),"object"!=typeof f[a].language_variables&&(f[a].language_variables=[]),f[a].language_variables&&(f[a].language_variables[e]=t),"development"!=d.mode||t&&0==n||(typeof f[a].language_var_sync>"u"&&(f[a].language_var_sync={}),("object"!=typeof f[a].language_var_sync||null==f[a].language_var_sync)&&(f[a].language_var_sync={}),f[a].language_var_sync[e]=t,l.Browser().storage[a.toLowerCase()].set({language_var_sync:JSON.stringify(f[a].language_var_sync)}).then()),t}async captureCurrentViewport(){return new Promise(((e,t)=>{console.log(l.Browser().tabs,l.Browser().tabs.captureVisibleTab),l.Browser().tabs.captureVisibleTab(void 0,{format:"jpeg",quality:80}).then((a=>a?e(a):t(null)))}))}setAIImageURL(e){let t=d.lang_cache_type;typeof f[t]>"u"||(l.Browser().storage[t.toLowerCase()].set({ai_image_url:e}).then(),typeof f[t].ai_image_url>"u"&&(f[t].ai_image_url={}),f[t].ai_image_url=e)}syncLangVar(){setTimeout((()=>{if("development"!=d.mode)return;let e=d.lang_cache_type;if(l.Browser().storage[e.toLowerCase()].set({language_var_sync:JSON.stringify(f[e].language_var_sync)}).then(),l.Browser().storage[e.toLowerCase()].set({language_variables:JSON.stringify(f[e].language_variables)}).then(),typeof f[e].language_var_sync<"u"){if(!l.notUndefined(f[e],"language_var_sync"))return;let t=f[e].language_var_sync;if(Object.keys(t).length>0){let a={data:t,language:"en"};l.apiCall("/languages/lang/sync",a,"POST",-1).then((t=>{l.Browser().storage[e.toLowerCase()].remove(["language_var_sync"]).then()}))}}}),2e3)}auth(e,t,a="register",n){let l=n.target,i=!1;l.setAttribute("disabled","disabled");let o=l.closest(`#${a}`);document.querySelectorAll(".input-error").forEach((e=>{e.classList.remove("input-error")}));let s=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/;return null==t.email&&(t.email=""),(t.email.length<3||!t.email.match(s))&&(null!=o&&o.querySelector('[name="email"]').classList.add("input-error"),this.notify.error(this.__("Please check your e-mail address.")),i=!0,l.removeAttribute("disabled")),"register"==a?(null==t.password&&(t.password=""),null==t.password1&&(t.password1=""),null==t.agree&&(t.agree=!1),t.password.length<3&&(null!=o&&o.querySelector('[name="password"]').classList.add("input-error"),this.notify.error(this.__("Please check your password.")),l.removeAttribute("disabled"),i=!0),t.password1.length<3&&(null!=o&&o.querySelector('[name="password1"]').classList.add("input-error"),this.notify.error(this.__("Please check your confirm password.")),l.removeAttribute("disabled"),i=!0),t.password1!=t.password&&(e.forms.password1=null,null!=o&&o.querySelector('[name="password1"]').classList.add("input-error"),this.notify.error(this.__("Your passwords do not match. Please check and try again.")),l.removeAttribute("disabled"),i=!0),0==t.agree&&(null!=o&&o.querySelector('[name="agree"]').classList.add("input-error"),this.notify.error(this.__("I have read and agree to terms.")),l.removeAttribute("disabled"),i=!0),1==i?void 0:this.apiCall("/auth/register",t,"POST").then((t=>{if(!(typeof t.status<"u"&&"error"==t.status))return this.uuid(1).then((()=>{e.login=!0,l.removeAttribute("disabled")}));l.removeAttribute("disabled")}))):"login"==a?(null==t.password&&(t.password=""),t.password.length<3&&(null!=o&&o.querySelector('[name="password"]').classList.add("input-error"),this.notify.error(this.__("Please check your password.")),l.removeAttribute("disabled"),i=!0),1==i?void 0:this.apiCall("/auth/login",t,"POST").then((t=>{if(!(typeof t.status<"u"&&"error"==t.status))return"success"==t.status?this.uuid(1).then((()=>{e.login=!0,l.removeAttribute("disabled")})):t;l.removeAttribute("disabled")}))):"recover"==a?1==i?void 0:this.apiCall("/auth/reset_password",t,"POST").then((t=>{if(!(typeof t.status<"u"&&"error"==t.status))return"success"==t.status?(e.login_type="login",l.removeAttribute("disabled"),!0):t;l.removeAttribute("disabled")})):void 0}scrollToBottom(e=null,t="#ai-message-container,#ait-prompt-container",a=null){if(!document)return;let n=e;document.querySelectorAll(t).forEach((t=>{let l=t;typeof l.scrollTop>"u"||(l.scrollTop,l.scrollHeight,l.clientHeight,null!==l.getAttribute("data-scroll-lock")&&null!==e?l.addEventListener("scroll",(()=>{const t=l.scrollTop,a=undefined,i=undefined,o=l.scrollHeight-t-l.clientHeight;let s=null;null!==l.querySelector("#aitopia-message [aria-details]")&&(s=l.querySelectorAll("#aitopia-message [aria-details]")[l.querySelectorAll("#aitopia-message [aria-details]").length-1]);let r=0;null!==s&&(s=s.querySelector(".ait-event-item:last-child"),null!==s&&(r=s.offsetHeight,r>0&&(e=n+r))),l.setAttribute("data-scroll-lock",o>e)})):l.setAttribute("data-scroll-lock",!1),"false"==(l.getAttribute("data-scroll-lock")??!1).toString()&&setTimeout((()=>{if(typeof l.scrollTop<"u"){const t=a??l.scrollHeight+5e4;l.scrollTo({top:t,behavior:"smooth"}),null==e&&setTimeout((()=>{l.scrollTo({top:t,behavior:"smooth"}),l.setAttribute("data-scroll-lock",!1)}),900),l.setAttribute("data-scroll-lock",!1)}}),30))}))}newChatId(){return Date.now()}ChatId(e,t,a=0){let n=null,i=f.Local.ai_chat_ids??{};return typeof i<"u"&&0==a&&typeof i[e]<"u"&&(null!=t&&"__all"!=t?(i[e][t]||"number"==typeof i[e])&&(n=i[e][t]):n=i[e]),null==n&&(a=1),e&&1==a&&(t?((typeof i[e]>"u"||"object"!=typeof i[e])&&(i[e]={}),n=i[e][t]=this.newChatId()):n=i[e]=this.newChatId()),l.Browser().storage.local.set({ai_chat_ids:i}).then(),n}GoogleSearchCall=async e=>{if(null==d.runtime_id)return!1;let t=l.notUndefined(f.Local,"settings.language")??null;if(null==t)try{return fetch("https://www.google.com/search?q="+e+"&sourceid=chrome&ie=UTF-8").then((e=>e.text())).catch(console.log)}catch{return!1}try{return fetch(`https://www.google.com/search?hl=${t}&lr=lang_${t}&as_q=${e.replace(/ /gi,"+")}&sourceid=chrome&ie=UTF-8`).then((e=>e.text())).catch(console.log)}catch{return!1}};GoogleSearchCallback=async(e,t={},a=!0)=>{let n=null;"object"==typeof e&&typeof e.result<"u"&&(t=e.data??{},e=e.result??{},n=l.notUndefined(t,"data"));let i=(new DOMParser).parseFromString(e,"text/html"),o="",s={},r=0,c="",u="",p={},g=i.querySelector("#search block-component table");null!=g&&(g=g.outerHTML);let m="";if(null!=g){let e=i.querySelectorAll("#search block-component table");null!=i.querySelector("#search block-component table table")&&(e=i.querySelectorAll("#search block-component table table")),e.forEach((e=>{e.querySelectorAll("tr").forEach(((e,t)=>{let a=e;null!=a.querySelector("th")?(a.querySelectorAll("th").forEach((e=>{let t=e;null!=t.querySelector('span[aria-hide],[class*="hide"]')?null!=t.querySelector("* span:last-child")&&(m+="  "+t.querySelector("* span:last-child").innerText.trim()):m+="  "+t.innerText.trim()})),m=m.trim()+"\n"):(a.querySelectorAll("td").forEach((e=>{let t=e;null!=t.querySelector("span[aria-hide]")?null!=t.querySelector("* span:last-child")&&(m+="  "+t.querySelector("* span:last-child").innerText.trim()):m+="  "+t.innerText.trim()})),m=m.trim()+"\n")}))}))}null!=i.querySelectorAll("#search [data-snc]")&&i.querySelectorAll("#search [data-snc]").forEach(((e,t)=>{Object.keys(s).length<=(d.web_access_search_limit??5)&&(e.querySelectorAll("[data-sncf],[data-snhf]").forEach(((e,t)=>{let a=!1,n=e,l=n.querySelector("a h3"),i=null;if(null!=l&&(a=!0,c=l.closest("a").getAttribute("href"),u=l.innerText),a||(i=n.querySelectorAll("a"),null!=i&&i.forEach((e=>{p[e.innerText]=e.getAttribute("href")}))),-1===n.innerHTML.indexOf('role="img"')&&!a){let e=n.innerText.split(" — ");o+=e[1]??e[0]}n.getAttribute("data-sncf")})),s[r]={text:o,url:c,title:u,sub_links:p},u=c=o="",p={},r++)}));let _=null;null!=i.querySelector("#search [data-entityname] [data-domdiff]")&&(_=i.querySelector("#search [data-entityname] [data-domdiff]").innerText.replace(/\n/gi," ")??null);let h=[];null!=i.querySelector("#search [data-q]")&&i.querySelectorAll("#search [data-q]").forEach((e=>{h.push(e.innerText)}));let y="";null!=i.getElementById("rhs")&&(null!=i.querySelector("g-card-section")&&i.querySelectorAll("g-card-section").forEach((e=>{if(null==e.closest('[role="button"]')){let t=e.innerText;t.length>0&&(y+="\n"+t)}})),null!=i.querySelector("#rhs g-link")&&i.querySelectorAll("#rhs g-link").forEach((e=>{if(null==e.closest('[role="button"]')){let t=e.innerText;t.length>0&&(y+="\n"+t)}})),i.querySelectorAll("#rhs [data-maindata]+div span,#rhs [data-maindata]+div .title").forEach((e=>{let t=e;null==t.closest('[role="button"]')&&t.innerText&&(y+="\n"+t.innerText)})),""==y&&(y=y.trim()));let b={};try{b={original_ask:n,data:s,extra:_,questions:h,detail:y,table:m}}catch{}let x=!1;if(Object.keys(l.notUndefined(b,"data")).length>0&&(x=!0),!x&&(l.notUndefined(e,"data.data")||l.notUndefined(t,"data"))){let a=await this.apiCall("/ai/search",{q:l.notUndefined(e,"data.data")||l.notUndefined(t,"data"),lang_code:l.notUndefined(f.Local,"settings.language")??null,model:w.ai_model},"POST");l.notUndefined(a,"data")&&(b={original_ask:l.notUndefined(a,"original_ask"),data:l.notUndefined(a,"data"),extra:null,questions:l.notUndefined(a,"questions"),detail:null,table:null})}if(a){let e=await l.Browser().storage.local.get("settings"),t=w.ai_model;l.notUndefined(e,"settings")&&(t=l.notUndefined(e,"settings.ai_model"));let a=typeof l.Browser().web_access_mode<"u"?l.Browser().web_access_mode:"ai_chat",i=typeof l.Browser().web_access_extra_key<"u"?l.Browser().web_access_extra_key:"__all";Q.chat(n,t,a,i,!0,!1,null,!0,{search:b,web_access:!0})}return new Promise(((e,t)=>e(b)))};cleanTextEmpty(e){return e&&e.replace(/[\r\n]+/gm," ").replace(/[\t]+/gm," ").replace(/[\s]+/gm," ").trim()}prepareContentForSearch(e){if(!e)return"";if("string"==typeof e)try{e=JSON.parse(e)}catch{return e.substring(0,2e3)}let t=[];if(e.meta&&(e.meta.title&&t.push(e.meta.title),e.meta.description&&t.push(e.meta.description)),e.importantTags&&["h1","h2","h3"].forEach((a=>{e.importantTags[a]&&t.push(e.importantTags[a].replace(/ OR /g," "))})),e.mainContent){const a=e.mainContent.split(/[.!?]+/).map((e=>e.trim())).filter((e=>e.length>20));a.length>0&&t.push(a.slice(0,3).join(" "))}return t.join(" ").replace(/\s+/g," ").replace(/[^\w\s-]/g,"").trim().substring(0,2e3)}parseMeaningfulContentFromHTML(e){var t,a,n,l,i,o,s;const r=(new DOMParser).parseFromString(e,"text/html");["script","style","iframe","nav","header","footer","aside","noscript","link","body .ad","body .advertisement","body #ads","body #ad-container","body .social-share","body .comments","body .related-articles",'body [class*="ads"]','body [id*="ads"]','body [class*="banner"]'].forEach((e=>{r.querySelectorAll(e).forEach((e=>e.remove()))}));const c={importantTags:{},meta:{title:"",description:""},mainContent:null};c.meta.title=(null==(a=null==(t=r.querySelector("title"))?void 0:t.textContent)?void 0:a.trim())||"",c.meta.description=(null==(l=null==(n=r.querySelector('meta[name="description"]'))?void 0:n.getAttribute("content"))?void 0:l.trim())||"",["h1","h2","h3","h4","h5","h6"].forEach((e=>{const t=r.querySelectorAll(e);t.length>0&&(c.importantTags[e]=Array.from(t).map((e=>{var t;return null==(t=null==e?void 0:e.textContent)?void 0:t.trim()})).filter((e=>e)).join(" OR "))}));const d=["article","main",".content",".post-content",".article-content","#main-content",'[role="main"]'];for(const u of d){const e=r.querySelector(u);if(e){c.mainContent=(null==(i=null==e?void 0:e.textContent)?void 0:i.trim().replace(/\s+/g," ").replace(/\n\s*/g,"\n").replace(/\s*\n\s*\n\s*/g,"\n\n"))||null;break}}return c.mainContent||(c.mainContent=(null==(s=null==(o=null==r?void 0:r.body)?void 0:o.textContent)?void 0:s.trim().replace(/\s+/g," ").replace(/\n\s*/g,"\n").replace(/\s*\n\s*\n\s*/g,"\n\n"))||null),c}setSidebar(e="#aitopia-full-screen",t="aitopia-full"){if(!document)return;let a=document.createElement("div");a.id="aitopia-container";let n=document.createElement("div");n.id="aitopia",null!=document.querySelector(e)?(n.id=t,document.querySelector(e).classList.add("aitopia")):n.classList.add("aitopia"),n.append(a);let l=document.querySelector("body");-1==(l.getAttribute("id")??"").indexOf("aitopia")&&(l=document.querySelector("html")),null==l||l.append(n)}tabExtensionPage=(e=null)=>{if(l.notUndefined(e,"filters")){let t=!0;return l.Browser().tabs.query(l.notUndefined(e,"filters")).then((a=>{a.forEach((a=>{if(t=!1,l.notUndefined(e,"filter_url")?-1!==a.url.indexOf(l.notUndefined(e,"filter_url"))&&(t=!0):t=!0,console.log(t,l.notUndefined(e,"filter_url")),l.notUndefined(e,"url")&&t&&(e.active=!0,l.Browser().tabs.update(a.id,{url:e.url}).then()),t)return a}))}))}};removeEmptyLines(e){return e&&e.replace(/^\s*[\r\n]/gm,"").trim()}treeKeybyValueBuild(e,t,a,n=".",l=0,i={}){if("object"!=typeof e&&(e=e.split(n)),typeof e[l]>"u")return t;typeof a[e[l]]<"u"&&(i[e[l]]=a[e[l]]);try{i[e[l]]=this.treeKeybyValueBuild(e,t,a,n,l+1,i[e[l]]??{})}catch(o){console.error(o,"BBB")}return i}Browser(){return d.Browser}addLoading(){if(null==d.runtime_id&&typeof document<"u"){let e="body > .aitopia";return null==d.runtime_id&&(e="body.aitopia"),void(document&&null!=document.querySelector(e)&&null==document.querySelector(e+".ait-page-loading")&&document.querySelector(e).classList.add("ait-page-loading"))}}removeLoading(){let e=".ait-page-loading-container";if(null!=d.runtime_id&&(e="#aitopia-full-screen .ait-page-loading-container"),typeof document<"u"&&document&&null!=document.querySelector(e)&&(document.querySelectorAll(e).forEach((e=>e.classList.add("ait-loading-calm"))),document.querySelectorAll(e).forEach((e=>e.remove())),setTimeout((()=>{document.querySelectorAll(e).forEach((e=>e.remove())),l.scrollToBottom()}),5)),typeof document<"u"&&document){let e="body > .aitopia";null==d.runtime_id&&(e="body.aitopia"),setTimeout((()=>{null!=document.querySelector(e+".ait-page-loading")&&document.querySelector(e+".ait-page-loading").classList.remove("ait-page-loading"),l.scrollToBottom()}),1)}}removeFirstLoading(){null==d.runtime_id&&typeof document<"u"&&null!=document.querySelector(".ait-page-loading-container")&&(document.querySelectorAll(".ait-page-loading-container").forEach((e=>e.classList.add("ait-loading-calm"))),document.querySelectorAll(".ait-page-loading-container").forEach((e=>e.remove())),setTimeout((()=>{document.querySelectorAll(".ait-page-loading-container").forEach((e=>e.remove()))}),5))}async getIpDetail(){return{}}syncTimeout=null;_syncAppAndExtensionOrTabs=async(e=null)=>{"object"==typeof e&&null!==e&&0===Object.keys(e).length&&(e=null);let t=null;null==d.runtime_id&&(t=d.domain);let a=!0,n=!1;null!=e&&(typeof e.back<"u"&&(a=!1),typeof e.type<"u"&&(n=e.type),typeof e.setter_domain<"u"&&(t=e.setter_domain),typeof e.storage<"u"&&(e=e.storage));let i={storage:e,type:n,setter_domain:t};if(null!=d.runtime_id)return null!=e&&await l.GetSetSyncData(i),await l.TabMessageSync({target:null,function:async e=>(e.back=!1,await window.postMessage({fn:"SyncAppAndExtensionOrTabs",data:e})),args:[i]},t);if(null==e){if(!l.notUndefined(d.ExtensionBrowser,"runtime.sendMessage"))return!1;i.storage=await l.GetSetSyncData();let e=await d.ExtensionBrowser.runtime.sendMessage(d.manuel_extension_id,{fn:"GetSetSyncData",data:i});if(i.storage=l.notUndefined(e,"return_data"),i.type=!0,"object"==typeof i.storage&&null!=i.storage&&0==Object.keys(i.storage).length&&(i.storage=null),null==i.storage)return{}}else if(i.type=!1,a){if(!l.notUndefined(d.ExtensionBrowser,"runtime.sendMessage"))return!1;await d.ExtensionBrowser.runtime.sendMessage(d.manuel_extension_id,{fn:"SyncAppAndExtensionOrTabs",data:i})}return await l.GetSetSyncData(i)};SyncAppAndExtensionOrTabs=async(e=null)=>(this.syncTimeout&&clearTimeout(this.syncTimeout),new Promise((t=>{this.syncTimeout=setTimeout((async()=>{let a=await this._syncAppAndExtensionOrTabs(e);t(a)}),400)})));GetSetSyncData=async(e=null)=>{if(null!=e){let t=!1;l.notUndefined(e,"setter_domain")&&l.notUndefined(e,"setter_domain"),typeof e.type<"u"&&(t=e.type);let a=l.notUndefined(f.Local,"migration"),n=l.notUndefined(e,"storage.local.migration");return null==n&&(n=l.notUndefined(e,"storage.local.ai_chat_ids.ai_chat")),0==t&&(t=a<n||null==a),1==t&&l.notUndefined(e,"storage")?(Object.keys(e.storage).forEach((t=>{if(l.notUndefined(l.Browser().storage,t)){let i=t.toCapitalizeCase();null==a&&(e.storage.local.migration=n??(new Date).getTime()),e.storage[t]&&(e.storage[t]=l.JsonParse(e.storage[t]),(typeof e.storage[t].settings>"u"||null!=l.notUndefined(e.storage[t],"settings"))&&(f.Local.migration_status=!0,e.storage[t].migration_status=!0,l.Browser().storage[t].set(e.storage[t]).then((()=>{f.Local.migration_status=!1,l.Browser().storage.local.set({migration_status:!1}),f[i]=Object.assign(f[i],e.storage[t])}))))}})),{}):{local:l.JsonParse(f.Local),sync:l.JsonParse(f.Sync),runtime_id:d.runtime_id}}return{local:l.JsonParse(f.Local),sync:l.JsonParse(f.Sync),runtime_id:d.runtime_id}};TabMessageSync=async(e,t=null)=>{if(l.notUndefined(l.Browser().tabs,"query")&&d.domain_allows&&e){let a=/^(?:https?:\/\/)?(?:[^@\n]+@)?(?:www\.)?([^:\/\n\?\=]+)/im,n=Object.values(d.domain_allows);null!=t&&-1!==n.indexOf(t)&&n.splice(n.indexOf(t),1),n.forEach((t=>{l.Browser().tabs.query({status:"complete"}).then((n=>{n.forEach((async n=>{if(n.url){let i=n.url.match(a)[1]??null;null!=i&&-1!==i.indexOf(d.web_app_prefix+t)&&(-1!==n.url.indexOf("https://"+d.web_app_prefix+t+"/")||-1!==n.url.indexOf("https://beta_"+d.web_app_prefix+t+"/"))&&(f.Local.migration_status=!0,e.target={tabId:n.id},await l.Browser().scripting.executeScript(e),f.Local.migration_status=!1,await l.Browser().storage.local.set({migration_status:!1}))}}))}))}))}};setHistory=(e,t)=>l.apiCall("/extensions/app/set_history",{chat_id:e,history:t},"POST").then((async e=>{if(l.notUndefined(e,"all_histories")){let t=l.notUndefined(e,"all_histories");return t&&(t=l.getHistoryFixer(t)),l.Browser().storage.local.set({histories:t}),t}}));getHistories=(e=!1)=>new Promise((t=>l.Browser().storage.local.get("histories").then((a=>typeof a.histories<"u"&&0==e&&null!=a.histories&&Object.keys(a.histories).length>0?t(a.histories):l.apiCall("/extensions/app/get_history",null,"POST").then((async e=>{if(l.notUndefined(e,"all_histories")){let t=l.notUndefined(e,"all_histories");return t&&(t=l.getHistoryFixer(t)),l.Browser().storage.local.set({histories:t}),t}}))))));getActiveHistories=async(e={})=>{let t=await l.Browser().storage.local.get("ai_chat_ids")??{};return t.ai_chat_ids&&(t=t.ai_chat_ids),await l.apiCall("/extensions/app/get_active_history",{chat_ids:t},"POST").then((async e=>{if(l.notUndefined(e,"histories")){let a=l.notUndefined(e,"histories"),n=l.notUndefined(e,"history_ids");a&&(a=l.getHistoryFixer(a));let i=await l.Browser().storage.local.get("ai_single").ai_single??{};i=Object.assign(i,a.ai_single);let o={};return a.ai_chat&&Object.keys(a.ai_chat).length>0&&(o.ai_chat=a.ai_chat),i&&Object.keys(i).length>0&&(o.ai_single=i),n&&Object.keys(n).length>0&&(n=Object.assign(n,t),o.ai_chat_ids=n,f.Local.ai_chat_ids=n),Object.keys(o).length>0&&await l.Browser().storage.local.set(o),f.Local=Object.assign(f.Local,o),{histories:a,history_ids:n}}}))};getHistoryFixer=e=>{let t=this.__("Hello, how can I help you today?");return Object.keys(e).forEach((a=>{l.notUndefined(e,a)&&(l.notUndefined(e[a],"0.role")?"user"==l.notUndefined(e[a],"0.role")&&(e[a]=[{item:t,role:"assistant",model:l.notUndefined(e[a],"0.model"),loading:!1},...Object.values(e[a])]):Object.keys(e[a]).forEach((n=>{l.notUndefined(e[a],n)&&l.notUndefined(e[a][n],"items")&&"user"==l.notUndefined(e[a][n].items,"0.role")&&(e[a][n].items=[{item:t,role:"assistant",model:l.notUndefined(e[a][n].items,"0.model"),loading:!1},...Object.values(e[a][n].items)])})))})),e};getSearchFilter=(e,t=null,a=!1)=>t?Object.values(e).filter((e=>"object"==typeof e?Object.values(e).some((e=>"object"==typeof e&&1==a?JSON.stringify(e).toString().toLowerCase().includes(t.toLowerCase()):e.toString().toLowerCase().includes(t.toLowerCase()))):"string"==typeof e?-1!==e.toLowerCase().indexOf(t.toString().toLowerCase()):void 0)):e;getKeySearch=(e,t=null,a=!1,n=!1)=>{if(!t)return e;let l=null;return l=1==a?{}:[],Object.keys(e).some((i=>{i.toString().toLowerCase().includes(t.toLowerCase())&&(1==a?n?l[i.replace(t,"")]=e[i]:l[i]=e[i]:l.push(i)),i.toString().toLowerCase().includes(t.toLowerCase())})),l};domainByUrls=e=>{l.Browser().storage.local.set({domain:e});let t=d.web_app_prefix+e,a={domain:e,site:`https://${t}`,site_buy_plan:`https://${t}/subscription`,site_payment:`https://${t}/payment`,site_pricing:`https://${t}/pricing`,login:`https://${t}/auth`,api_url:`https://${d.api_mode}.${e}`,download_url:`https://download.${e}`,cdn_url:`https://cdn.${e}`};return d.domain_allows&&-1===d.domain_allows.indexOf(e)&&d.domain_allows.push(e),Object.keys(a).forEach((e=>{d[e]=a[e]})),a};ObjectSorting=(e,t=!0,a=null)=>Object.fromEntries(Object.entries(e).sort((([,e],[,n])=>(null!==a&&(typeof e[a]<"u"&&(Number.isNaN(parseFloat(e[a]))||(e=e[a])),typeof n[a]<"u"&&(Number.isNaN(parseFloat(n[a]))||(n=n[a]))),t?parseFloat(e)-parseFloat(n):parseFloat(n)-parseFloat(e)))));clearStorage=(e=!1)=>{1==e&&(l.Browser().storage.local&&l.Browser().storage.local.clear(),l.Browser().storage.sync&&l.Browser().storage.sync.clear());let t=["app_details","check_extension_expire","check_extension","token_usage","credits","licences","uuid_hopekey","uuid_search","expires","credit_usage","credit_detail","credit_detail_visual","start_scrap","language_var_sync","language_variables","languages","ai_models","ai_type_models","ai_prompts","selected_ask","selected_question","selected_write","prompt_settings","model_settings","files","faq","packages","developer","domain","draggable_modal_history","ai_chat_ids","ai_contextPrompts","delete_key","ai_single","speech_record","ai_ask","campaign_modal_api","campaign_modal_later","campaign_modal_limit","campaign_modal_limit_date"];l.Browser().storage.local.get().then((e=>{l.Browser().storage.local.remove(l.getKeySearch(e,"ai_single_"))}));let a={ai_single:[l.SHA1("image"),l.SHA1("chat_with_file")]};l.Browser().storage.local.get("delete_key").then((e=>{"object"==typeof e.delete_key&&Object.values(e.delete_key).forEach((e=>{a.ai_single.push(e)}))})),l.Browser().storage.local.get("ai_prompts").then((e=>{let t={};if(typeof e.ai_prompts<"u"){try{t=JSON.parse(e.ai_prompts)}catch{t=e.ai_prompts}let a=[];Object.values(t).forEach((e=>{let t=e.mode;"object"==typeof t&&(t=t.join(",")),-1==a.indexOf("selected_"+t)&&a.push("selected_"+t)})),l.Browser().storage.local.remove(a).then()}})),l.Browser().storage.local.remove(t).then(),Object.keys(a).forEach((e=>{l.Browser().storage.local.get(e).then((t=>{if(typeof t[e]<"u"){let n=!1,i=!1;try{t[e]=JSON.parse(t[e]),i=!0}catch{}let o=a[e];null!==t[e]&&("object"==typeof t[e]?Object.keys(t[e]).forEach((a=>{-1===o.indexOf(a)&&(n=!0,delete t[e][a])})):(n=!0,delete t[e])),i&&(t[e]=JSON.stringify(t[e])),n&&l.Browser().storage.local.set(t).then()}}))})),l.Browser().storage.local.remove(["ai_setup"]).then(),l.Browser().storage.local.set({show_sidebar:!1}).then()};promptIdByGetValues=e=>{let t=f.Local.prompt_settings,a=f.Local.model_settings,n={};return t&&(Object.keys(t).forEach((i=>{if(-1!==i.indexOf(e)){let e=i.split("-_-"),o=e[0],s=t[i],r=l.notUndefined(a,`${o}`),c=l.notUndefined(r,`items.${s}`),d=l.notUndefined(c,"title");n[i]={name:r.title,id:e[0]??null,value:s,priority:e[1].split("_")[1]??0,title:d??o}}})),n=l.ObjectSorting(n,!0,"priority")),n};emptyResolve=()=>new Promise(((e,t)=>{}));onSettingTypeByValue(e,t){if(e&&typeof e.type<"u"){if(typeof e.mode<"u"&&"attribute"==e.mode)return t.getAttribute(e.type);if(typeof t[e.type]<"u")return t[e.type]}}emailSuggestion=async(e,t,a)=>{let n=this.MD5(e);return l.Browser().storage.local.get("email_suggestions").then((async i=>l.notUndefined(i,"email_suggestions."+n)?l.notUndefined(i,"email_suggestions."+n):await this.apiCall("/ai/email_suggestion",{text:e,history:t,extra_data:a},"POST").then((e=>(i[n]=e,e)))))};positionByScreenCalc(e,t=10){let a=Math.max(-1,Math.min(e.top,window.innerHeight-(e.top+e.height+t)));a=a<=0?-(e.height+t):e.height+t;let n=Math.max(-1,Math.min(e.top,window.innerWidth-(e.top+e.width+t)));return n=n<=0?-(e.width+t):e.width+t,{top:a,left:n}}async getYtSummarize(){let e="",t=null;if(typeof window<"u"&&window.location&&-1!==window.location.host.indexOf("youtube.")){t=window.ytInitialPlayerResponse??null,null===t&&document.querySelectorAll("body script").forEach((e=>{if(e){let a=e;if(-1!==a.innerText.indexOf("var ytInitialPlayerResponse"))try{t=JSON.parse(a.innerText.match("{.*:{.*:.*}}")[0])}catch{}}}));let a=f.Local.settings.language;if(typeof(null==t?void 0:t.captions)>"u")return{};if(typeof(null==t?void 0:t.captions.playerCaptionsTracklistRenderer)>"u")return{};if(typeof(null==t?void 0:t.captions.playerCaptionsTracklistRenderer.captionTracks)>"u")return{};let n=null==t?void 0:t.captions.playerCaptionsTracklistRenderer.captionTracks,i=null;if(n&&(n.forEach((e=>{a===e.languageCode&&(i=l.notUndefined(e,"baseUrl"))})),null==i&&(i=l.notUndefined(n,"0.baseUrl"))),null!==i&&t){let a=await fetch(i).then((e=>e.text())),n={compact:!1,ignoreComment:!0,spaces:4};a=l.JsonParse(ue.xml2json(a,n))??a;let o=l.notUndefined(a,"elements.0.elements");return o&&o.forEach(((t,a)=>{let n={text:"",start:l.notUndefined(t,"attributes.start"),dur:l.notUndefined(t,"attributes.dur")},i=l.notUndefined(t,"elements");i&&i.forEach(((e,t)=>{n.text+=0!==t?" "+e.text:e.text})),e+="second:"+parseFloat(n.start).toFixed(0)+" text:"+n.text+"\n"})),{content:e,detail:t,url:i}}}}eventMarkedInText(){document.querySelector(".aitopia").addEventListener("mouseover",(e=>{let t=e.target.closest("pre code");if(null!=t&&null===t.querySelector(".ait-code-toolbox")&&null===t.querySelector(".ait-pre-header")){let e=t.innerText,a=document.createElement("div");a.classList.add("ait-code-toolbox");let n=document.createElement("button");n.value=l.__("Copy"),n.classList.add("ait-code-copy"),n.setAttribute("data-content",e),n.textContent=n.value,a.append(n);let i=document.createElement("button");i.value=l.__("Download"),i.classList.add("ait-code-download"),i.setAttribute("data-content",e);let o=Object.values(t.classList).join(" ");i.setAttribute("data-type",o.replace(/hljs language-/g,"")),i.textContent=i.value,a.append(i),t.append(a)}})),document.querySelector(".aitopia").addEventListener("mouseout",(e=>{null==e.target.closest("pre code")&&(null!=document.querySelector(".ait-code-toolbox")?document.querySelector(".ait-code-toolbox").remove():null!=document.querySelector(".ait-pre-header")?document.querySelector(".ait-pre-header").remove():(null!=document.querySelector(".ait-code-copy")&&document.querySelector(".ait-code-copy").remove(),null!=document.querySelector(".ait-code-download")&&document.querySelector(".ait-code-download").remove()))})),document.querySelector(".aitopia").addEventListener("click",(e=>{var t,a;let n=e.target;null!=(t=n.classList)&&t.contains("ait-code-copy")&&l.copyClipboard(n.getAttribute("data-content")),null!=(a=n.classList)&&a.contains("ait-code-download")&&l.downloadContent(n.getAttribute("data-content"),"plain/text","aitopia_"+Date.now()+"."+n.getAttribute("data-type"));let i=n.getAttribute("href");if(i&&-1!==i.indexOf("#")&&n.closest(".aitopia .ai_result")){let t=n.innerText;n.closest(".aitopia .ai_result").querySelectorAll("h1,h2,h3,h4,h5,h6").forEach((a=>{(a.textContent.includes(t)||a.textContent.includes(i.replace(/-/," ").replace("#","")))&&(a.scrollIntoView(),e.stopPropagation(),e.preventDefault())}))}}))}downloadContent(e,t,a){const n=document.createElement("a"),l=new Blob([e],{type:t}),i=URL.createObjectURL(l);n.setAttribute("href",i),n.setAttribute("download",a),n.click(),this.notify&&this.notify.success(a+" "+this.__("Downloaded."))}encodeHTML(e){return e.replace(/([\u00A0-\u9999<>&])(.|$)/g,(function(e,t,a){return"&"!==t||"#"!==a?(/[\u00A0-\u9999<>&]/.test(a)&&(a="&#"+a.charCodeAt(0)+";"),"&#"+t.charCodeAt(0)+";"+a):e}))}decodeHTML(e){return e.replace(/&#([0-9]+);/g,(function(e,t){return String.fromCharCode(parseInt(t))}))}groupChatListener(){}sortValueLength(e=[],t="DESC"){return null==e?e:e.sort(((e,a)=>"ASC"==t?e.length-a.length:a.length-e.length))}sortObjectKeys(e){return Object.keys(e).sort().reduce((function(t,a){return t[a]=e[a],t}),{})}RegexSpecialFixer(e){return e.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}fancyTimeFormat(e){const t=~~(e/3600),a=~~(e%3600/60),n=~~e%60;let l="";return t>0&&(l+=t+":"+(a<10?"0":"")),l+=a+":"+(n<10?"0":""),l+=""+n,l}isNative(e){return/\{\s*\[native code\]\s*\}/.test(""+e)}async announcementModal(e){e&&typeof e.id<"u"&&l.Browser().storage.local.get("announcements").then((t=>{let a={};typeof t.announcements<"u"&&(a=t.announcements),(typeof a[e.id]>"u"||typeof e.force<"u")&&(a[e.id]=e),l.Browser().storage.local.set({announcements:a})}))}extensionID(){return null!==d.runtime_id?d.runtime_id:d.manuel_extension_id}async checkExtension(e=!1){return d.manuel_extension_id==d.runtime_id?d.runtime_id:await l.Browser().storage.local.get(["check_extension_expire","check_extension"]).then((async t=>{let a=t.check_extension_expire??null,n=t.check_extension??d.runtime_id,i=parseInt(Date.now().toString().substring(0,10)),o=5,s={};if((a??0)>i&&!e)return n;n!=d.runtime_id&&await fetch("chrome-extension://"+n+"/aitopia/service-worker-loader.js").then((e=>e.text())).then((e=>{})).catch((async e=>{n=d.runtime_id,await l.Browser().storage.local.set({check_extension:n,check_extension_delete:!0})}));let r=(Date.now()+3e5).toString().substring(0,10);s.check_extension_expire=parseInt(r),s.check_extension=n,await l.Browser().storage.local.set(s);try{let e=await fetch("chrome-extension://"+d.manuel_extension_id+"/service-worker-loader.js").then((e=>e.text())).then((e=>{s.check_extension=d.manuel_extension_id})).catch((e=>{}))}catch{}return await l.Browser().storage.local.set(s),await l.Browser().storage.local.set({check_extension:s.check_extension}),console.log(s),s.check_extension}))}hex2rgb(e){const t=undefined,a=undefined,n=undefined;return`${parseInt(e.slice(1,3),16)}, ${parseInt(e.slice(3,5),16)}, ${parseInt(e.slice(5,7),16)}`}simpleSymbols(e){return!/([^+]|^)[A-Za-z]([^+]|$)/.test(e)}formatCompactNumber(e,t="en"){let a={notation:"compact"};return Intl.NumberFormat(t,a).format(e)}urlToObjectUrl(e){return new URL(e)}toSeoUrl(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/[^a-z0-9\s-]/g,"").trim().replace(/\s+/g,"-").replace(/-+/g,"-")}responseByNotify(e,t=null,a=null,n=null){if(typeof e.status<"u"){if("error"==e.status)return null!==a?(l.notify.error(a),e):(l.notify.error(e.message??"error"),e);if("warning"==e.status)return null!==n?(l.notify.warning(n),e):(l.notify.warning(e.message??"error"),e)}l.notify.success(l.__("Added Agent")),console.log(e)}autoPositionDropdown=(e,t)=>{if(!e||!document.querySelector("#ai-sidebar-content"))return;const a=document.querySelector("#ai-sidebar-content");if(!a)return;const n=t||e.parentElement;if(!n)return;a.getBoundingClientRect();const l=n.getBoundingClientRect(),i=e.getBoundingClientRect(),o=window.innerWidth,s=undefined;let r="bottom",c="left";const d=window.innerHeight-l.bottom,u=l.top;d<i.height&&u>i.height&&(r="top");const p=o-l.left,g=l.right;p<i.width&&g>i.width&&(c="right"),e.classList.remove("ait-position-top","ait-position-bottom","ait-position-left","ait-position-right");let m=20;return"top"===r?(e.style.setProperty("bottom","100%","important"),e.style.setProperty("top","auto","important"),e.style.setProperty("margin-bottom","4px","important"),e.style.setProperty("margin-top","0","important")):(e.style.setProperty("top","100%","important"),e.style.setProperty("bottom","auto","important"),e.style.setProperty("margin-top","4px","important"),e.style.setProperty("margin-bottom","0","important")),"right"===c?(e.style.setProperty("right","auto","important"),e.style.setProperty("left",`-${i.width-m}px`,"important")):(e.style.setProperty("left","0","important"),e.style.setProperty("right","auto","important")),{topPosition:r,leftPosition:c}};initAutoPositionDropdowns=()=>{const e=new MutationObserver((e=>{e.forEach((e=>{e.addedNodes.forEach((e=>{var t,a;if(e.nodeType===Node.ELEMENT_NODE){const n=e;null!=(t=n.classList)&&t.contains("ait-panel-auto-position")&&setTimeout((()=>this.autoPositionDropdown(n)),10);const l=null==(a=n.querySelectorAll)?void 0:a.call(n,".ait-panel-auto-position");null==l||l.forEach((e=>{setTimeout((()=>this.autoPositionDropdown(e)),10)}))}}))}))})),t=document.querySelector("#aitopia");t&&e.observe(t,{childList:!0,subtree:!0}),document.querySelectorAll(".ait-panel-auto-position").forEach((e=>{this.autoPositionDropdown(e)}))}}Object.defineProperty(String.prototype,"toFirstUpperCase",{value:function(){return this?`${this.substring(0,1).toUpperCase()}${this.substring(1)}`:this}}),Object.defineProperty(String.prototype,"toEscapeHTML",{value:function(){return this?this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"):this}}),Object.defineProperty(String.prototype,"toUnEscapeHTML",{value:function(){return this?this.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'"):this}}),Object.defineProperty(String.prototype,"toCapitalizeCase",{value:function(){if(!this)return this;let e=this.split(" ");return e.forEach(((t,a)=>{e[a]=t.toFirstUpperCase()})),`${e.join(" ")}`}}),Object.defineProperty(Object.prototype,"searchElement",{value:function(e){return this?(l.getSearchFilter(this,e)??[null])[0]??null:this}}),Object.defineProperty(Object.prototype,"sortKey",{value:()=>l.sortObjectKeys(void 0)}),Object.defineProperty(Array.prototype,"sortValueLength",{value:function(e="DESC"){return l.sortValueLength(this,e)}});const l=new me;export{Q as A,ce as B,V as E,l as H,_e as R,f as S,w as a,d as c};